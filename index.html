<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="Cache-Control" content="no-store, max-age=0" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mr Samuels‚Äô Grade 10 English Hub</title>
<style>
  :root{
    --bg:#070b1a; --panel:rgba(14,18,36,.72); --glass:rgba(20,26,55,.55);
    --text:#e7f2ff; --muted:#a8bfdd; --accent:#00f5d4; --accent2:#ff5e57; --accent3:#8a5cff; --accent4:#fca311;
    --good:#2ecc71; --bad:#ff4d6d;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 10% -10%,#102153 0,#0c1736 30%,#070b1a 65%) fixed;color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:1220px;margin:0 auto;padding:20px}
  header{position:relative;display:flex;align-items:center;gap:10px;margin-bottom:14px}
  .brand{font-weight:900;font-size:24px;letter-spacing:.5px}
  .neon{background:linear-gradient(90deg,var(--accent),var(--accent3));-webkit-background-clip:text;background-clip:text;color:transparent}
  .tabs{margin-left:auto;display:flex;gap:10px;flex-wrap:wrap}
  .tab-btn{border:1px solid rgba(255,255,255,.08);padding:10px 14px;border-radius:999px;background:linear-gradient(180deg,#121a38,#0d1430);color:var(--text);cursor:pointer}
  .tab-btn.active{color:#061314;background:linear-gradient(180deg,var(--accent) 0,var(--accent3) 100%);font-weight:800;box-shadow:0 0 24px rgba(0,245,212,.25)}
  .badge{background:linear-gradient(90deg,var(--accent3),var(--accent2));padding:6px 10px;border-radius:999px;font-size:12px}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,.2)}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#101a34;border:1px solid rgba(255,255,255,.08);color:#a8bfdd;font-size:12px}
  .btn{border:0;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;color:#061314;background:linear-gradient(180deg,var(--accent) 0,var(--accent3) 100%);box-shadow:0 6px 22px rgba(138,92,255,.25)}
  .btn.secondary{color:#cfe7ff;background:linear-gradient(180deg,#1b2546 0,#121c3a 100%);border:1px solid rgba(255,255,255,.08)}
  .btn.warn{color:#130a00;background:linear-gradient(180deg,#ffd166 0,var(--accent4) 100%)}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .card{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:16px;box-shadow:inset 0 0 0 1px rgba(255,255,255,.04),0 10px 40px rgba(0,0,0,.35),0 0 50px rgba(138,92,255,.05);backdrop-filter:blur(8px)}
  .flex{display:flex;gap:16px;flex-wrap:wrap}.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}.grow{flex:1 1 360px}
  .muted{color:var(--muted)} .big{font-size:18px}
  .grid-2{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
  @media (max-width:980px){.grid-2{grid-template-columns:1fr}}

  /* Stat cards */
  .statgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  @media (max-width:900px){.statgrid{grid-template-columns:repeat(2,1fr)}}
  .stat{background:linear-gradient(180deg,#101837,#0c1330);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px}
  .stat h4{margin:0 0 6px 0;font-size:12px;color:#bcd1ff}.stat .v{font-size:24px;font-weight:900}
  .avatar{width:56px;height:56px;border-radius:14px;background:linear-gradient(180deg,var(--accent3),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:900}
  .lb{list-style:none;margin:8px 0 0 0;padding:0}.lb li{padding:8px 10px;border:1px solid rgba(255,255,255,.1);border-radius:10px;background:linear-gradient(180deg,#0f1836,#0b1230);display:flex;justify-content:space-between;margin-bottom:8px}

  /* Hangman */
  .hm-title{font-weight:800;margin:0 0 8px 0;letter-spacing:.4px}
  canvas{background:linear-gradient(180deg,#0c1228,#0a0f21);border:1px solid rgba(255,255,255,.1);border-radius:16px;max-width:100%}
  .slots{letter-spacing:.28em;font-size:26px;margin:10px 0 6px;white-space:pre}
  .kbd{display:grid;grid-template-columns:repeat(10,1fr);gap:6px;margin-top:12px}
  .key{background:linear-gradient(180deg,#131e41,#101936);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:10px 0;text-align:center;font-weight:700;cursor:pointer;color:#cfe7ff}
  .key.used{opacity:.35;pointer-events:none}
  .hint{background:linear-gradient(180deg,#0f1837,#0b1230);border:1px solid rgba(255,255,255,.08);padding:10px;border-radius:10px}
  .good{color:var(--good)} .bad{color:var(--bad)}

  /* 30 Seconds */
  input[type="text"]{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:linear-gradient(180deg,#0c1530,#0a1126);color:#e6eef5;font-size:16px}
  .def-box{font-size:18px;line-height:1.45}.hourglass{width:58px;height:90px}.sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0)}

  /* Millionaire */
  .ladder{list-style:none;padding:0;margin:0;display:flex;flex-direction:column-reverse;gap:6px}
  .ladder li{padding:8px 10px;border:1px solid rgba(255,255,255,.12);border-radius:12px;background:linear-gradient(180deg,#0f1836,#0b1230);font-weight:700;display:flex;justify-content:space-between}
  .ladder li.active{background:linear-gradient(90deg,rgba(0,245,212,.35),rgba(138,92,255,.35));border-color:var(--accent);color:#e9fcff}
  .opt{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
  .opt button{padding:12px;border-radius:12px;border:2px solid rgba(255,255,255,.12);background:linear-gradient(180deg,#10193a,#0d1633);color:#e6eef5;font-weight:800;cursor:pointer}
  .opt .right{border-color:var(--good);box-shadow:0 0 18px rgba(46,204,113,.3)}
  .opt .wrong{border-color:var(--bad);box-shadow:0 0 18px rgba(255,77,109,.25)}

  /* Study */
  .subtabs{display:flex;gap:8px;margin-bottom:10px}
  .sub-btn{border:1px solid rgba(255,255,255,.1);padding:8px 12px;border-radius:999px;background:linear-gradient(180deg,#121a38,#0d1430);color:#cfe7ff;cursor:pointer}
  .sub-btn.active{color:#061314;background:linear-gradient(180deg,var(--accent2),var(--accent3));font-weight:800;box-shadow:0 0 18px rgba(255,94,87,.22)}
  table{width:100%;border-collapse:collapse}
  th,td{border:1px solid rgba(255,255,255,.08);padding:8px;vertical-align:top}
  th{background:linear-gradient(180deg,#0f1837,#0b1230)}

  /* Toast / Confetti / Student panel */
  .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#0d1640;border:1px solid rgba(255,255,255,.12);color:#dff3ff;padding:10px 14px;border-radius:999px;opacity:0;transition:opacity .2s, transform .2s;pointer-events:none;z-index:150}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}
  .student-panel{position:absolute;right:8px;top:56px;display:none;width:320px;z-index:20}
  .field{display:flex;flex-direction:column;gap:6px;flex:1}
  label{font-size:12px;color:#cfdcff}
  select,input{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:linear-gradient(180deg,#0c1530,#0a1126);color:#e6eef5;font-size:16px}

  /* English Driver (road-fighter) */
  .driver-wrap{display:grid;grid-template-columns:1fr;gap:10px}
  .driver-controls{display:flex;gap:10px;justify-content:center}
  .ctrl{width:120px;height:120px;border-radius:18px;border:2px solid rgba(255,255,255,.1);background:linear-gradient(180deg,#10193a,#0d1633);color:#e6eef5;font-size:22px;font-weight:900;box-shadow:0 6px 22px rgba(0,0,0,.25);touch-action:none}
  .ctrl:active{transform:scale(.98)}
  @media (max-width:600px){.ctrl{width:100px;height:100px;font-size:20px}}
  .hud{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  .overlayQ{position:absolute;inset:0;background:rgba(7,11,26,.8);display:none;align-items:center;justify-content:center;z-index:50}
  .overlayCard{max-width:560px;background:linear-gradient(180deg,#0f1837,#0b1230);border:1px solid rgba(255,255,255,.15);border-radius:16px;padding:16px}
  .overlayCard .opt{grid-template-columns:1fr}
  .confetti-piece{position:fixed;top:0;left:0;width:8px;height:14px;opacity:.9;pointer-events:none;border-radius:2px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">Mr Samuels‚Äô <span class="neon">Grade 10 English Hub</span></div>
    <span id="studentBadge" class="badge">Guest Mode</span>
    <button id="btnStudent" class="tab-btn ghost">Set Student</button>
    <div id="studentPanel" class="card student-panel">
      <div class="muted" style="margin-bottom:6px">Optional ‚Äî doesn‚Äôt block the games.</div>
      <div class="field"><label>Name</label><input id="stName" type="text" placeholder="e.g., Sizwe"></div>
      <div class="field"><label>Surname</label><input id="stSurname" type="text" placeholder="e.g., Mokoena"></div>
      <div class="field"><label>Class</label>
        <select id="stClass"><option>10A</option><option>10B</option><option>10C</option></select>
      </div>
      <div class="row" style="margin-top:8px">
        <button id="stSave" class="btn">Save</button>
        <button id="stClose" class="btn secondary">Close</button>
      </div>
    </div>
    <div class="tabs">
      <button class="tab-btn active" data-tab="dash">Dashboard</button>
      <button class="tab-btn" data-tab="hangman">Hangman</button>
      <button class="tab-btn" data-tab="seconds">30 Seconds</button>
      <button class="tab-btn" data-tab="million">Millionaire</button>
      <button class="tab-btn" data-tab="driver">English Driver</button>
      <button class="tab-btn" data-tab="study">Study</button>
    </div>
  </header>

  <!-- DASHBOARD -->
  <section id="dash" class="card">
    <div class="grid-2">
      <div class="card" style="background:linear-gradient(180deg,#0c1430,#0a1126);">
        <div class="row">
          <div class="avatar" id="avatar">G</div>
          <div>
            <div class="muted">Student</div>
            <div id="d_name" style="font-weight:900;font-size:20px">Guest</div>
            <div id="d_class" class="muted">‚Äî</div>
          </div>
        </div>
        <div class="row" style="margin-top:10px">
          <button class="btn secondary" id="btnResetStats">Reset My Stats</button>
          <button class="btn" id="btnQuickPlay">Jump into Hangman</button>
        </div>
      </div>

      <div class="card">
        <div class="muted">Notes</div>
        <div class="big">Touch-friendly. Optional student details save to this device. Confetti for correct answers; thumbs-down for wrong.</div>
      </div>
    </div>

    <div class="statgrid" style="margin-top:12px">
      <div class="stat"><h4>Merits</h4><div class="v" id="s_merits">0</div></div>
      <div class="stat"><h4>Hangman Wins</h4><div class="v" id="s_hm_wins">0</div></div>
      <div class="stat"><h4>30 Seconds ‚Äî Fastest Correct</h4><div class="v" id="s_30_fast">‚Äî</div></div>
      <div class="stat"><h4>30 Seconds ‚Äî Correct Total</h4><div class="v" id="s_30_total">0</div></div>
      <div class="stat"><h4>Millionaire ‚Äî Best Step</h4><div class="v" id="s_mil_best">0 / 15</div></div>
      <div class="stat"><h4>Millionaire ‚Äî Correct</h4><div class="v" id="s_mil_correct">0</div></div>
      <div class="stat"><h4>Millionaire ‚Äî Answered</h4><div class="v" id="s_mil_answered">0</div></div>
      <div class="stat"><h4>Driver ‚Äî Best Run</h4><div class="v" id="s_drv_best">0 m</div></div>
    </div>
  </section>

  <!-- HANGMAN -->
  <section id="hangman" class="card" style="display:none">
    <div class="flex">
      <div class="grow" style="max-width:480px">
        <h2 class="hm-title">Mr Samuels ‚Äì Grade 10 HL Hangman</h2>
        <canvas id="hmCanvas" width="430" height="280" aria-label="Hangman drawing"></canvas>
      </div>
      <div class="grow">
        <div class="row">
          <span class="pill">Lives: <span id="lives" class="lives">6</span></span>
          <span class="pill">Wins: <span id="wins">0</span></span>
        </div>
        <div id="slots" class="slots">_ _ _ _ _</div>
        <div id="used" class="muted">Used: ‚Äî</div>
        <div class="row" style="margin-top:8px">
          <button id="btnHint" class="btn secondary">Show Hint</button>
          <button id="btnNew" class="btn">New Word</button>
          <button id="btnReveal" class="btn warn">Reveal</button>
        </div>
        <div id="hint" class="hint" style="margin-top:10px;display:none"></div>
        <div id="result" class="big" style="margin-top:8px"></div>
        <div class="kbd" id="keyboard" style="margin-top:10px"></div>
      </div>
    </div>
  </section>

  <!-- 30 SECONDS -->
  <section id="seconds" class="card" style="display:none">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div class="pill">Round Score: <span id="secScore">0</span></div>
      <div class="row" style="gap:10px;align-items:center">
        <svg id="hourglass" viewBox="0 0 100 160" class="hourglass" aria-label="Timer hourglass">
          <defs><clipPath id="clipTop"><polygon points="20,20 80,20 50,80"/></clipPath>
                 <clipPath id="clipBottom"><polygon points="20,140 80,140 50,80"/></clipPath></defs>
          <rect id="hgTop" x="20" y="20" width="60" height="60" fill="#fca311" clip-path="url(#clipTop)"/>
          <rect id="hgBottom" x="20" y="140" width="60" height="0" fill="#fca311" clip-path="url(#clipBottom)"/>
          <rect id="hgStream" x="48.5" y="78" width="3" height="0" fill="#fca311" visibility="hidden"/>
          <polygon points="20,20 80,20 50,80 20,140 80,140 50,80" fill="none" stroke="#cfe7ff" stroke-width="4"/>
          <rect x="15" y="10" width="70" height="8" fill="#cfe7ff"/><rect x="15" y="142" width="70" height="8" fill="#cfe7ff"/>
        </svg>
        <span id="secTime" class="sr-only">30</span>
      </div>
    </div>
    <div id="defBox" class="def-box" style="margin:10px 0 8px"></div>
    <input id="secInput" type="text" placeholder="Type the word here‚Ä¶" autocomplete="off" />
    <div class="row" style="margin-top:10px">
      <button id="secStart" class="btn">Start 30-second Round</button>
      <button id="secSkip" class="btn secondary" disabled>Skip</button>
      <button id="secGive" class="btn warn" disabled>Give Answer</button>
      <span class="pill">Correct total: <span id="secTotal">0</span></span>
    </div>
    <div id="secFeedback" class="big" style="margin-top:8px"></div>
    <div id="secLast" class="muted" style="margin-top:6px"></div>
  </section>

  <!-- MILLIONAIRE -->
  <section id="million" class="card" style="display:none">
    <div class="grid-2">
      <div>
        <div class="row" style="justify-content:space-between;align-items:center">
          <div class="pill">Question <span id="milStep">1</span>/15</div>
          <div class="row">
            <button id="mil5050" class="btn secondary">50:50</button>
            <button id="milSkip" class="btn secondary">Skip</button>
            <button id="milQuit" class="btn warn">Quit</button>
          </div>
        </div>
        <div id="milQ" class="def-box" style="margin-top:10px;font-weight:700"></div>
        <div class="opt" id="milOpts" style="margin-top:10px"></div>
        <div id="milFeedback" class="big" style="margin-top:10px"></div>
        <div class="row" style="margin-top:10px">
          <button id="milStart" class="btn">Start New Game</button>
        </div>
      </div>
      <div><ul class="ladder" id="milLadder"></ul></div>
    </div>
  </section>

  <!-- ENGLISH DRIVER -->
  <section id="driver" class="card" style="display:none">
    <div class="driver-wrap">
      <div class="row hud" style="justify-content:space-between">
        <span class="pill">Distance: <b id="drvDist">0</b> m</span>
        <span class="pill">Speed: <b id="drvSpeed">50</b> m/s</span>
        <span class="pill">Score: <b id="drvScore">0</b></span>
        <button id="drvStart" class="btn">Start Run</button>
        <button id="drvPause" class="btn secondary">Pause</button>
      </div>
      <div style="position:relative;display:flex;justify-content:center">
        <canvas id="drvCanvas" width="380" height="560" style="border-radius:16px;border:1px solid rgba(255,255,255,.1)"></canvas>
        <div id="drvOverlay" class="overlayQ">
          <div class="overlayCard">
            <div class="big" id="drvQ">Question here</div>
            <div id="drvOpts" class="opt" style="margin-top:10px"></div>
          </div>
        </div>
      </div>
      <div class="driver-controls">
        <button id="drvLeft" class="ctrl">‚üµ<br/><small>LEFT</small></button>
        <button id="drvRight" class="ctrl">‚ü∂<br/><small>RIGHT</small></button>
      </div>
    </div>
  </section>

  <!-- STUDY -->
  <section id="study" class="card" style="display:none">
    <div class="subtabs">
      <button class="sub-btn active" data-sub="studyVocab">Vocabulary</button>
      <button class="sub-btn" data-sub="lotf">Lord of the Flies</button>
      <button class="sub-btn" data-sub="shakespeare">Shakespeare</button>
    </div>

    <!-- Vocabulary -->
    <div id="studyVocab">
      <div class="row">
        <input id="studySearch" type="text" placeholder="Search word/definition/example‚Ä¶" />
        <button id="studyReset" class="btn secondary">Clear</button>
        <button id="studyPrint" class="btn">Print</button>
      </div>
      <div style="overflow:auto; max-height:60vh; margin-top:8px">
        <table id="studyTable"><thead><tr><th style="width:18%">Word</th><th style="width:37%">Definition</th><th>Example sentence</th></tr></thead><tbody></tbody></table>
      </div>
    </div>

    <!-- LOTF -->
    <div id="lotf" style="display:none">
      <div class="row">
        <button id="lotfFilterAll" class="btn secondary">All</button>
        <button id="lotfFilterPlot" class="btn secondary">Plot</button>
        <button id="lotfFilterThemes" class="btn secondary">Themes</button>
        <button id="lotfFilterChars" class="btn secondary">Characters</button>
        <button id="lotfFilterSymbol" class="btn secondary">Symbolism</button>
        <button id="lotfPrint" class="btn">Print</button>
      </div>
      <div id="lotfList" style="max-height:60vh; overflow:auto; margin-top:8px"></div>
    </div>

    <!-- Shakespeare -->
    <div id="shakespeare" style="display:none">
      <div class="card" style="margin-bottom:10px">
        <div class="big"><b>Shakespeare Study Pack</b> ‚Äî <b>Sonnet 18</b> & <b>Romeo and Juliet</b> (expanded Q&A; NOT numbered like the Topic Test).</div>
      </div>
      <div id="shQA" style="max-height:60vh; overflow:auto;"></div>
      <div class="row" style="margin-top:8px">
        <button id="shExpandAll" class="btn secondary">Expand all answers</button>
        <button id="shCollapseAll" class="btn secondary">Collapse all</button>
        <button id="shPrint" class="btn">Print</button>
      </div>
    </div>
  </section>
</div>

<div class="toast" id="toast">Saved</div>

<script>
/* ---------- audio ---------- */
let AC;
function tone(f=500,d=0.12,type="sine",g=0.15){
  try{
    AC=AC||new(window.AudioContext||window.webkitAudioContext)();
    const o=AC.createOscillator(), v=AC.createGain();
    o.type=type; o.frequency.value=f; o.connect(v); v.connect(AC.destination);
    const t=AC.currentTime; v.gain.setValueAtTime(0.0001,t);
    v.gain.exponentialRampToValueAtTime(g,t+0.01);
    v.gain.exponentialRampToValueAtTime(0.0001,t+d);
    o.start(t); o.stop(t+d+0.02);
  }catch(e){}
}
function beep(kind="ui"){
  const map={ ui:[420,0.09,"sine",0.12], open:[560,0.12,"triangle",0.14], ok:[660,0.18,"triangle",0.2],
              wrong:[200,0.18,"sawtooth",0.2], win:[880,0.25,"triangle",0.22], lose:[120,0.25,"sine",0.22], time:[300,0.18,"sine",0.18] };
  const [f,d,t,g]=map[kind]||map.ui; tone(f,d,t,g);
}
addEventListener("click",e=>{
  const el=e.target;
  if(el.closest("button") || el.closest(".tab-btn") || el.closest(".sub-btn")) beep("ui");
});

/* ---------- helpers / confetti & toasts ---------- */
const $=id=>document.getElementById(id);
const toast=msg=>{const t=$("toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),1200);};
function confettiBurst(msg="Nice!"){
  for(let i=0;i<48;i++){
    const p=document.createElement("div");
    p.className="confetti-piece";
    const clr=["#00f5d4","#8a5cff","#ff5e57","#fca311","#2ecc71"][Math.floor(Math.random()*5)];
    p.style.background=clr;
    p.style.left=(50+Math.random()*40-20)+"%";
    p.style.top="60%";
    const dx=(Math.random()*2-1)*200, dy= - (200+Math.random()*300);
    p.style.transform=`translate(0,0) rotate(0deg)`;
    p.style.transition="transform 1s ease-out, opacity 1.2s";
    document.body.appendChild(p);
    requestAnimationFrame(()=>{p.style.transform=`translate(${dx}px, ${dy}px) rotate(${Math.random()*360}deg)`; p.style.opacity="0";});
    setTimeout(()=>p.remove(),1200);
  }
  toast("üéâ "+msg); beep("win");
}
function thumbsDown(msg="Try again"){toast("üëé "+msg); beep("wrong");}
const shuffle=a=>a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(v=>v[1]);

/* ---------- VOCAB ---------- */
const TERMS=[
  {w:"sonnet",d:"A 14-line poem with a specific rhyme scheme.",e:"Shakespeare‚Äôs Sonnet 18 is a sonnet in iambic pentameter."},
  {w:"iambic pentameter",d:"A rhythm pattern of five iambs per line.",e:"'Shall I compare thee' scans in iambic pentameter."},
  {w:"metaphor",d:"A direct comparison without 'like' or 'as'.",e:"'Eye of heaven' is a metaphor for the sun."},
  {w:"personification",d:"Giving human traits to non-human things.",e:"'Death brag' personifies death."},
  {w:"oxymoron",d:"Two contradictory terms together.",e:"'Brawling love' in Romeo and Juliet."},
  {w:"soliloquy",d:"A speech revealing a character‚Äôs inner thoughts.",e:"Juliet‚Äôs Act 3 soliloquy reveals her anxiety."},
  {w:"dramatic irony",d:"Audience knows more than characters.",e:"We know Juliet isn‚Äôt dead; the characters don‚Äôt."},
  {w:"foil",d:"A character who contrasts another.",e:"Piggy is a foil to Jack in LotF."},
  {w:"symbolism",d:"Objects or actions representing ideas.",e:"The conch symbolises order in LotF."},
  {w:"allegory",d:"A narrative with deeper moral/political meaning.",e:"LotF is an allegory of civilisation vs savagery."},
  {w:"microcosm",d:"A small system reflecting a larger one.",e:"The island is a microcosm of society."},
  {w:"protagonist",d:"Main character who drives the plot.",e:"Ralph is a protagonist in LotF."},
  {w:"antagonist",d:"Character opposing the protagonist.",e:"Jack is Ralph‚Äôs antagonist."},
  {w:"theme",d:"Central idea explored by a text.",e:"Abuse of power is a theme in LotF."},
  {w:"motif",d:"Recurring element with significance.",e:"Chanting is a motif for mob mentality in LotF."},
  {w:"temperate",d:"Mild; moderate.",e:"'More temperate' describes the beloved in Sonnet 18."},
  {w:"complexion",d:"Skin appearance; also the look of a thing.",e:"The sun‚Äôs 'gold complexion' can be dimmed."},
  {w:"lease",d:"A fixed period of use; tenure.",e:"'Summer‚Äôs lease' suggests it ends."},
  {w:"savagery",d:"Brutal or violent behaviour.",e:"Jack‚Äôs tribe descends into savagery."},
  {w:"civilisation",d:"Organised society with rules and order.",e:"Ralph tries to maintain civilisation on the island."},
  {w:"conch",d:"A shell used to call assemblies; symbol of order.",e:"Whoever holds the conch may speak."},
  {w:"beast",d:"Imagined monster symbolising inner fear.",e:"The 'beast' reflects the boys‚Äô own darkness."},
  {w:"fire",d:"Signal fire symbolises hope and rescue.",e:"Neglecting the fire leads to missed rescue."},
  {w:"specs",d:"Piggy‚Äôs glasses; tool of science and reason.",e:"Glasses start the fire ‚Äî power of technology."},
  {w:"anarchy",d:"Absence of authority; disorder.",e:"Without rules, the island slides into anarchy."}
];

/* ---------- LOTF study notes ---------- */
const LOTF_NOTES=[
  {type:"Plot", text:"A group of British schoolboys is stranded on a deserted island. Ralph, elected leader, prioritises rescue (signal fire). Jack focuses on hunting. The boys descend into fear and savagery, leading to the deaths of Simon and Piggy; a naval officer finally rescues them."},
  {type:"Themes", text:"Civilisation vs Savagery; Loss of Innocence; Power & Leadership; Fear and the 'Beast'."},
  {type:"Themes", text:"Groupthink & Mob Mentality: chanting, face paint, ritual hunts suppress individual morality."},
  {type:"Characters", text:"Ralph ‚Äî elected leader; values order and rescue; civilisation."},
  {type:"Characters", text:"Piggy ‚Äî intelligence/logic; glasses = science; killed by Roger."},
  {type:"Characters", text:"Jack ‚Äî authoritarian hunter; uses fear/punishment; savagery."},
  {type:"Characters", text:"Simon ‚Äî spiritual insight; realises the 'beast' is within; killed in frenzy."},
  {type:"Characters", text:"Roger ‚Äî sadist; kills Piggy with boulder."},
  {type:"Symbolism", text:"Conch ‚Äî law & order; shattering = end of democracy."},
  {type:"Symbolism", text:"Signal Fire ‚Äî hope of rescue; neglect = moral decline."},
  {type:"Symbolism", text:"Piggy‚Äôs Glasses ‚Äî knowledge/technology; power shifts when stolen."},
  {type:"Symbolism", text:"Painted Faces ‚Äî anonymity ‚Üí savagery."},
  {type:"Symbolism", text:"Lord of the Flies ‚Äî evil within humanity."}
];

/* ---------- Millionaire questions ---------- */
const QUESTION_BANK=[
  {q:"Who is elected leader at the beginning of Lord of the Flies?",options:["Ralph","Jack","Piggy","Simon"],correct:"Ralph"},
  {q:"Which object symbolises order and democratic speech?",options:["The conch","The fire","The glasses","The spear"],correct:"The conch"},
  {q:"Jack‚Äôs priority soon becomes‚Ä¶",options:["Hunting","Shelters","Keeping the fire","Exploring"],correct:"Hunting"},
  {q:"What do Piggy‚Äôs glasses most strongly symbolise?",options:["Reason and science","Beauty","Wealth","Tradition"],correct:"Reason and science"},
  {q:"Who kills Piggy?",options:["Roger","Jack","Ralph","The naval officer"],correct:"Roger"},
  {q:"What is the 'beast' ultimately revealed to be?",options:["The boys‚Äô inner savagery","A real monster","A wild boar","A ghost"],correct:"The boys‚Äô inner savagery"},
  {q:"Which character represents spiritual goodness and insight?",options:["Simon","Jack","Roger","Samneric"],correct:"Simon"},
  {q:"The signal fire represents‚Ä¶",options:["Hope of rescue","Punishment","Wealth","Boredom"],correct:"Hope of rescue"},
  {q:"Why do the boys paint their faces?",options:["To feel anonymous and savage","To look beautiful","To honor Ralph","For warmth"],correct:"To feel anonymous and savage"},
  {q:"The shattering of the conch signifies‚Ä¶",options:["Collapse of order","A celebration","More equality","The arrival of adults"],correct:"Collapse of order"},
  {q:"What does the naval officer‚Äôs arrival create at the end?",options:["A sudden return to civilisation","A new war","A bigger fire","A second island"],correct:"A sudden return to civilisation"},
  {q:"Which theme best fits the boys‚Äô chanting and mob dances?",options:["Mob mentality","Romantic love","Economic growth","Pastoral beauty"],correct:"Mob mentality"},
  {q:"What does Jack primarily use to control his tribe?",options:["Fear and punishment","Fair debate","Shared leadership","Random votes"],correct:"Fear and punishment"},
  {q:"Which pair best contrasts leadership styles?",options:["Ralph vs Jack","Piggy vs Simon","Roger vs Sam","Officer vs Jack"],correct:"Ralph vs Jack"},
  {q:"'Lord of the Flies' (pig‚Äôs head) most closely symbolises‚Ä¶",options:["Evil within humanity","Royal authority","Religious salvation","Wealth"],correct:"Evil within humanity"},
  {q:"A 14-line poem with regular meter is called a‚Ä¶",options:["Sonnet","Ode","Elegy","Haiku"],correct:"Sonnet"},
  {q:"'Eye of heaven' in Sonnet 18 is a‚Ä¶",options:["Metaphor for the sun","Simile","Alliteration","Hyperbole"],correct:"Metaphor for the sun"},
  {q:"'Wherefore art thou Romeo?' means‚Ä¶",options:["Why are you Romeo?","Where are you?","When will you come?","Who are you?"],correct:"Why are you Romeo?"},
  {q:"Which family is Romeo from?",options:["Montague","Capulet","Escalus","Paris"],correct:"Montague"},
  {q:"Dramatic irony is when‚Ä¶",options:["Audience knows more than characters","Two words sound alike","A character talks to themselves","The setting is ironic"],correct:"Audience knows more than characters"}
];

/* ---------- Topic-Test MCQs (for English Driver) ---------- */
const TOPIC_TEST_MCQ = [
  {q:"In Sonnet 18, the beloved is first compared to a‚Ä¶",options:["Summer‚Äôs day","Winter‚Äôs night","Stormy sea","Rose"],correct:"Summer‚Äôs day"},
  {q:"The phrase 'summer‚Äôs lease' suggests that summer is‚Ä¶",options:["Temporary","Perfect","Eternal","Rainy"],correct:"Temporary"},
  {q:"'Eye of heaven' is best identified as‚Ä¶",options:["Metaphor","Simile","Onomatopoeia","Pun"],correct:"Metaphor"},
  {q:"The poem claims the beloved‚Äôs beauty will live on through‚Ä¶",options:["Eternal lines","A painting","A statue","A diary"],correct:"Eternal lines"},
  {q:"'Wherefore art thou Romeo?' means‚Ä¶",options:["Why are you Romeo?","Where are you?","When are you coming?","Who are you?"],correct:"Why are you Romeo?"},
  {q:"Juliet‚Äôs main conflict is between love and‚Ä¶",options:["Family loyalty","Money","Fame","Travel"],correct:"Family loyalty"},
  {q:"Friar Laurence is surprised because Romeo‚Ä¶",options:["Switched from Rosaline to Juliet","Refuses to marry","Wants to fight Tybalt","Plans to leave Verona"],correct:"Switched from Rosaline to Juliet"},
  {q:"The Friar warns that sudden passions‚Ä¶",options:["Can lead to trouble","Are always good","Never change","Make you stronger"],correct:"Can lead to trouble"},
];

/* ---------- Shakespeare Q&A (renumbered; larger set) ---------- */
const SHAKESPEARE_QA = [
  {section:"POETRY ‚Äî Sonnet 18 (Understanding & Technique)", items:[
    {q:"S1. Opening image: What familiar scene does the poet use to begin?", a:"A summer‚Äôs day, used as a comparator to the beloved."},
    {q:"S2. Identify and explain the figure of speech in 'the eye of heaven'.", a:"Metaphor (and implied personification): the sun is pictured as an eye that 'shines', suggesting power and scrutiny."},
    {q:"S3. What do the words 'summer‚Äôs lease' imply?", a:"Summer is temporary; a limited 'lease' that expires."},
    {q:"S4. What turns at line 9 (the volta)?", a:"The poem pivots from summer‚Äôs flaws to the beloved‚Äôs 'eternal summer' preserved in verse."},
    {q:"S5. In your own words, explain 'So long lives this, and this gives life to thee.'", a:"As long as the poem is read, it keeps the beloved alive in memory."},
    {q:"S6. EXTRA: Give one example of sound device and its effect.", a:"Alliteration in 'fair from fair' highlights decline; the repetition sounds like fading."}
  ]},
  {section:"DRAMA ‚Äî Romeo and Juliet (Balcony & Themes)", items:[
    {q:"S7. Paraphrase 'Wherefore art thou Romeo?'", a:"Juliet asks why he must be Romeo (a Montague) rather than 'Where are you?'."},
    {q:"S8. What conflict drives the scene?", a:"Love vs family loyalty/name and the social feud."},
    {q:"S9. What does 'I‚Äôll be new baptized' reveal about Romeo?", a:"He is impulsive and passionate; ready to change his name/identity for love."},
    {q:"S10. How does the scene push the plot forward?", a:"They resolve to pursue love in secret, speeding the tragedy through haste and miscommunication."},
    {q:"S11. Why is Friar Laurence sceptical of Romeo?", a:"Romeo switches affection from Rosaline to Juliet very quickly; the Friar warns about sudden passions."},
    {q:"S12. EXTRA: Give one example of dramatic irony in the play.", a:"In Act 5, the audience knows Juliet isn‚Äôt dead, but Romeo doesn‚Äôt ‚Äî leading to tragedy."}
  ]}
];

/* ---------- tabs ---------- */
document.querySelectorAll(".tab-btn").forEach(b=>b.addEventListener("click",()=>{
  document.querySelectorAll(".tab-btn").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
  const t=b.dataset.tab;
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  $(t).style.display="";
  if(t!=="driver") pauseDriver(); // stop the car when leaving
  beep("open");
}));
document.querySelectorAll(".sub-btn").forEach(b=>b.addEventListener("click",()=>{
  document.querySelectorAll(".sub-btn").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
  const t=b.dataset.sub;
  ["studyVocab","lotf","shakespeare"].forEach(id=>$(id).style.display=(id===t)?"":"none");
  beep("open");
}));

/* ---------- student & stats ---------- */
const KEY_PREFIX="g10_english_hub_v3";
function studentId(s){return `${(s.class||'').toUpperCase()}-${(s.surname||'').trim().toLowerCase()}-${(s.name||'').trim().toLowerCase()}`||"guest";}
function defaultStats(student){return{student,createdAt:Date.now(),merits:0,hangman:{wins:0},seconds:{totalCorrect:0,totalRounds:0,fastestCorrectMs:null},million:{bestStep:0,totalAnswered:0,totalCorrect:0},driver:{bestMeters:0}};}
function loadStatsFor(student){const id=studentId(student);const raw=localStorage.getItem(`${KEY_PREFIX}:${id}`);return raw?JSON.parse(raw):defaultStats(student);}
function saveStats(stats){const id=studentId(stats.student);localStorage.setItem(`${KEY_PREFIX}:${id}`,JSON.stringify(stats));localStorage.setItem(`${KEY_PREFIX}:last`,JSON.stringify(stats.student));refreshDashboard();}
function getLastStudent(){try{return JSON.parse(localStorage.getItem(`${KEY_PREFIX}:last`))}catch{return null}}

let STATS = loadStatsFor(getLastStudent()||{name:"Guest",surname:"",class:""});
function setStudentUI(s){ $("studentBadge").textContent=(s.name?`${s.name} ${s.surname} ¬∑ ${s.class||'‚Äî'}`:"Guest Mode");
  $("d_name").textContent=s.name?`${s.name} ${s.surname}`:"Guest"; $("d_class").textContent=s.class||"‚Äî";
  const initials=(s.name?.[0]||"G")+(s.surname?.[0]||""); $("avatar").textContent=(initials||"G").toUpperCase();
}
function refreshDashboard(){
  setStudentUI(STATS.student);
  $("s_merits").textContent=STATS.merits;
  $("s_hm_wins").textContent=STATS.hangman.wins;
  $("s_30_total").textContent=STATS.seconds.totalCorrect;
  $("s_30_fast").textContent=STATS.seconds.fastestCorrectMs?(STATS.seconds.fastestCorrectMs/1000).toFixed(2)+"s":"‚Äî";
  $("s_mil_best").textContent=`${STATS.million.bestStep} / 15`;
  $("s_mil_correct").textContent=STATS.million.totalCorrect;
  $("s_mil_answered").textContent=STATS.million.totalAnswered;
  $("s_drv_best").textContent=(STATS.driver.bestMeters||0)+" m";
}
$("btnQuickPlay").onclick=()=>document.querySelector('.tab-btn[data-tab="hangman"]').click();
$("btnResetStats").onclick=()=>{STATS=defaultStats(STATS.student);saveStats(STATS);toast("Stats reset");beep("open");};

$("btnStudent").onclick=()=>{const s=STATS.student; $("stName").value=s.name||""; $("stSurname").value=s.surname||""; $("stClass").value=s.class||"10A"; $("studentPanel").style.display=""; beep("open");};
$("stClose").onclick=()=>{$("studentPanel").style.display="none";};
$("stSave").onclick=()=>{const s={name:$("stName").value.trim(),surname:$("stSurname").value.trim(),class:$("stClass").value.trim()}; const NEW=loadStatsFor(s.name? s : {name:"Guest",surname:"",class:""});
  if(NEW.merits===0 && NEW.hangman.wins===0 && NEW.seconds.totalCorrect===0 && NEW.million.totalAnswered===0 && NEW.driver.bestMeters===0){
    NEW.merits=STATS.merits; NEW.hangman=STATS.hangman; NEW.seconds=STATS.seconds; NEW.million=STATS.million; NEW.driver=STATS.driver;
  }
  STATS=NEW; saveStats(STATS); $("studentPanel").style.display="none"; toast("Student saved"); beep("ok");
};
refreshDashboard();

/* ---------- Hangman ---------- */
let hmWord="",hmMasked=[],hmLives=6,hmUsed=new Set(),hmHint="",hmWins=0;
const cvs=$("hmCanvas"),ctx=cvs.getContext("2d");
function drawGallows(){ctx.clearRect(0,0,cvs.width,cvs.height);ctx.strokeStyle="#cfe7ff";ctx.lineWidth=4;ctx.beginPath();ctx.moveTo(40,250);ctx.lineTo(200,250);ctx.stroke();ctx.beginPath();ctx.moveTo(80,250);ctx.lineTo(80,50);ctx.lineTo(260,50);ctx.lineTo(260,80);ctx.stroke();ctx.beginPath();ctx.moveTo(260,80);ctx.lineTo(260,105);ctx.stroke();}
function drawStage(s){ctx.strokeStyle="#fca311";ctx.lineWidth=4;if(s===1){ctx.beginPath();ctx.arc(260,120,16,0,Math.PI*2);ctx.stroke();}if(s===2){ctx.beginPath();ctx.moveTo(260,136);ctx.lineTo(260,182);ctx.stroke();}if(s===3){ctx.beginPath();ctx.moveTo(260,146);ctx.lineTo(238,166);ctx.stroke();}if(s===4){ctx.beginPath();ctx.moveTo(260,146);ctx.lineTo(282,166);ctx.stroke();}if(s===5){ctx.beginPath();ctx.moveTo(260,182);ctx.lineTo(245,212);ctx.stroke();}if(s===6){ctx.beginPath();ctx.moveTo(260,182);ctx.lineTo(275,212);ctx.stroke();}}
function drawByMistakes(m){drawGallows();for(let i=1;i<=m&&i<=6;i++)drawStage(i);}
const drawKeyboard=()=>{const kb=$("keyboard");kb.innerHTML="";"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(k=>{const b=document.createElement("button");b.className="key";b.textContent=k;b.onclick=()=>guess(k);kb.appendChild(b);});};
function newWord(){const {w,d}=TERMS[Math.floor(Math.random()*TERMS.length)];hmWord=w.toUpperCase();hmHint=d;hmMasked=hmWord.split("").map(ch=>/[A-Z]/.test(ch)?"_":ch);hmLives=6;hmUsed=new Set();$("slots").textContent=hmMasked.join(" ");$("lives").textContent=hmLives;$("used").textContent="Used: ‚Äî";$("hint").style.display="none";$("hint").textContent="Hint: "+hmHint;$("result").textContent="";document.querySelectorAll(".key").forEach(k=>k.classList.remove("used"));drawByMistakes(0);beep("open");}
function reveal(){$("slots").textContent=hmWord.split("").join(" ");$("result").innerHTML=`Answer: <b>${hmWord}</b>`;beep("open");}
function guess(letter){if(hmLives<=0||hmUsed.has(letter))return;hmUsed.add(letter);document.querySelectorAll(".key").forEach(k=>{if(k.textContent===letter)k.classList.add("used");});$("used").textContent="Used: "+[...hmUsed].join(" ");if(hmWord.includes(letter)){hmWord.split("").forEach((ch,i)=>{if(ch===letter)hmMasked[i]=letter;});$("slots").textContent=hmMasked.join(" ");beep("ok");if(!hmMasked.includes("_")){$("result").innerHTML=`<span class="good">Great! You solved it.</span>`;hmWins++;$("wins").textContent=hmWins;STATS.hangman.wins++;saveStats(STATS);confettiBurst("Hangman solved!");}}else{hmLives--;$("lives").textContent=hmLives;drawByMistakes(6-hmLives);if(hmLives<=0){$("result").innerHTML=`<span class="bad">Out of lives!</span> The word was <b>${hmWord}</b>.`;beep("lose");toast("Round over");}else{thumbsDown("Wrong letter");}}}
drawKeyboard();newWord();$("btnHint").onclick=()=>{$("hint").style.display=$("hint").style.display==="none"?"":"none";beep("open");};$("btnNew").onclick=()=>newWord();$("btnReveal").onclick=()=>reveal();

/* ---------- 30 Seconds ---------- */
let secRoundActive=false,secTime=30,secTimer=null,secScore=0,secTotal=0,secQueue=[],secCurrent=null,secQuestionStart=null;
const secDuration=30;
function updateHourglass(){const HG=60,prog=1-(secTime/secDuration),topH=(1-prog)*HG,bottomH=prog*HG;$("hgTop").setAttribute("height",topH.toFixed(2));$("hgBottom").setAttribute("y",(140-bottomH).toFixed(2));$("hgBottom").setAttribute("height",bottomH.toFixed(2));const stream=$("hgStream");if(secRoundActive&&secTime>0&&secTime<secDuration){const len=8+34*prog;stream.setAttribute("y",(80-len).toFixed(2));stream.setAttribute("height",len.toFixed(2));stream.setAttribute("visibility","visible");}else stream.setAttribute("visibility","hidden");}
function secondsReset(){secRoundActive=false;secTime=secDuration;secScore=0;secQueue=shuffle(TERMS.slice());secCurrent=null;secQuestionStart=null;clearInterval(secTimer);$("secTime").textContent=secTime;$("secScore").textContent=0;$("secFeedback").textContent="";$("secInput").value="";$("secInput").disabled=true;$("secSkip").disabled=true;$("secGive").disabled=true;$("defBox").innerHTML="Press <b>Start 30-second Round</b> to begin.";updateHourglass();}
function nextDefinition(){if(secQueue.length===0)secQueue=shuffle(TERMS.slice());secCurrent=secQueue.pop();$("defBox").innerHTML=`<b>Definition:</b> ${secCurrent.d}`;$("secInput").value="";$("secInput").focus();secQuestionStart=Date.now();beep("open");}
function startRound(){if(secRoundActive)return;secondsReset();secRoundActive=true;$("secInput").disabled=false;$("secSkip").disabled=false;$("secGive").disabled=false;nextDefinition();secTimer=setInterval(()=>{secTime--;$("secTime").textContent=secTime;updateHourglass();if(secTime<=0){endRound();beep("time");}},1000);beep("open");}
function endRound(){clearInterval(secTimer);secRoundActive=false;$("secInput").disabled=true;$("secSkip").disabled=true;$("secGive").disabled=true;$("secFeedback").innerHTML=`‚è±Ô∏è Round over. You scored <b>${secScore}</b>.`;$("secLast").innerHTML="";STATS.seconds.totalRounds++;saveStats(STATS);toast("Round finished");updateHourglass();}
$("secStart").onclick=startRound;$("secSkip").onclick=()=>{if(!secRoundActive)return;$("secLast").innerHTML=`Skipped: <b>${secCurrent.w}</b>`;nextDefinition();};$("secGive").onclick=()=>{if(!secRoundActive)return;$("secLast").innerHTML=`Answer: <b>${secCurrent.w}</b>`;nextDefinition();};
$("secInput").addEventListener("keydown",e=>{if(e.key==="Enter"){const g=e.target.value.trim().toLowerCase();if(!g)return;if(g===secCurrent.w.toLowerCase()){secScore++;secTotal++;$("secScore").textContent=secScore;$("secTotal").textContent=secTotal;$("secFeedback").innerHTML=`<span class="good">Correct!</span>`;STATS.seconds.totalCorrect++;const elapsed=Date.now()-secQuestionStart;const cur=STATS.seconds.fastestCorrectMs;if(!cur||elapsed<cur)STATS.seconds.fastestCorrectMs=elapsed;saveStats(STATS);confettiBurst("Nice one!");nextDefinition();}else{$("secFeedback").innerHTML=`<span class="bad">Try again.</span>`;thumbsDown("Incorrect");}}});
secondsReset();

/* ---------- Millionaire ---------- */
const ladderValues=["R 1 000 000","R 500 000","R 250 000","R 125 000","R 64 000","R 32 000","R 16 000","R 8 000","R 4 000","R 2 000","R 1 000","R 500","R 300","R 200","R 100"];
let milIndex=0,milUsed5050=false,milUsedSkip=false,milActive=false,milQSet=[],milHalfMeritGiven=false,milFinishMeritGiven=false;
function buildLadder(){const ul=$("milLadder");ul.innerHTML="";ladderValues.forEach((v,i)=>{const li=document.createElement("li");const step=ladderValues.length-i;li.innerHTML=`<span>${step}</span><span>${v}</span>`;ul.appendChild(li);});}
function highlightLadder(){const items=[...$("milLadder").children];items.forEach(li=>li.classList.remove("active"));const pos=ladderValues.length-milIndex;if(items[pos-1])items[pos-1].classList.add("active");}
function prepareGame(){milIndex=0;milUsed5050=false;milUsedSkip=false;milActive=false;milHalfMeritGiven=false;milFinishMeritGiven=false;$("milFeedback").textContent="";$("milStep").textContent="1";$("mil5050").disabled=false;$("milSkip").disabled=false;milQSet=shuffle(QUESTION_BANK).slice(0,15);renderQuestion();beep("open");}
function renderQuestion(){const q=milQSet[milIndex];$("milQ").innerHTML=q.q;const w=$("milOpts");w.innerHTML="";q.options.forEach((opt,i)=>{const b=document.createElement("button");b.dataset.opt=opt;b.innerHTML=`<span style="opacity:.8">${String.fromCharCode(65+i)})</span> ${opt}`;b.onclick=()=>checkAnswer(b,opt);w.appendChild(b);});highlightLadder();}
function maybeAwardMerits(){if(milIndex>=8 && !milHalfMeritGiven){STATS.merits+=1;milHalfMeritGiven=true;toast("+1 merit (Halfway!)");}
  if(milIndex>=15 && !milFinishMeritGiven && !milUsedSkip){STATS.merits+=2;milFinishMeritGiven=true;toast("+2 merits (Completed!)");}}
function checkAnswer(btn, choice){
  if(!milActive)milActive=true;
  const q=milQSet[milIndex],buttons=[...$("milOpts").querySelectorAll("button")];
  buttons.forEach(b=>b.disabled=true);STATS.million.totalAnswered++;
  if(choice.toLowerCase()===q.correct.toLowerCase()){
    STATS.million.totalCorrect++;btn.classList.add("right");beep("ok");
    setTimeout(()=>{milIndex++;STATS.million.bestStep=Math.max(STATS.million.bestStep,milIndex);maybeAwardMerits();saveStats(STATS);
      if(milIndex>=milQSet.length){$("milFeedback").innerHTML=`üèÜ <span class="good">Congratulations!</span> You reached <b>${ladderValues[0]}</b>.`;confettiBurst("Millionaire!");milActive=false;}
      else{$("milStep").textContent=String(milIndex+1);renderQuestion();}},380);
  }else{
    btn.classList.add("wrong");thumbsDown("Incorrect");
    const cbtn=buttons.find(b=>b.dataset.opt.toLowerCase()===q.correct.toLowerCase());if(cbtn)cbtn.classList.add("right");
    $("milFeedback").innerHTML=`Correct: <b>${q.correct}</b>.`;milActive=false;saveStats(STATS);
  }
}
$("mil5050").onclick=()=>{if(milUsed5050)return;milUsed5050=true;$("mil5050").disabled=true;const q=milQSet[milIndex],buttons=[...$("milOpts").querySelectorAll("button")];shuffle(buttons.filter(b=>b.dataset.opt.toLowerCase()!==q.correct.toLowerCase())).slice(0,2).forEach(b=>{b.disabled=true;b.style.opacity=.4;});};
$("milSkip").onclick=()=>{if(milUsedSkip)return;milUsedSkip=true;$("milSkip").disabled=true;milIndex++;STATS.million.bestStep=Math.max(STATS.million.bestStep,milIndex);saveStats(STATS);if(milIndex>=milQSet.length){$("milFeedback").innerHTML=`You skipped to the end.`;milActive=false;return}$("milStep").textContent=String(milIndex+1);renderQuestion();};
$("milQuit").onclick=()=>{milActive=false;$("milFeedback").innerHTML=`Run ended.`;};
$("milStart").onclick=()=>{buildLadder();prepareGame();};buildLadder();

/* ---------- Study: Vocab table ---------- */
function buildStudyTable(){const tb=$("studyTable").querySelector("tbody");tb.innerHTML="";TERMS.forEach(t=>{const tr=document.createElement("tr");tr.innerHTML=`<td><b>${t.w}</b></td><td>${t.d}</td><td><em>${t.e}</em></td>`;tb.appendChild(tr);});}
function filterStudy(){const q=$("studySearch").value.trim().toLowerCase();[...$("studyTable").querySelectorAll("tbody tr")].forEach(r=>{r.style.display=r.textContent.toLowerCase().includes(q)?"":"none";});}
$("studySearch").addEventListener("input",filterStudy);$("studyReset").onclick=()=>{$("studySearch").value="";filterStudy();};$("studyPrint").onclick=()=>{window.print();};

/* ---------- Study: LOTF ---------- */
function buildLotfList(filter="All"){const wrap=$("lotfList");wrap.innerHTML="";LOTF_NOTES.filter(n=>filter==="All"||n.type===filter).forEach((n)=>{const card=document.createElement("div");card.className="card";card.style.marginBottom="10px";card.innerHTML=`<div class="pill" style="margin-bottom:6px">${n.type}</div><div>${n.text}</div>`;wrap.appendChild(card);});}
$("lotfFilterAll").onclick=()=>buildLotfList("All");
$("lotfFilterPlot").onclick=()=>buildLotfList("Plot");
$("lotfFilterThemes").onclick=()=>buildLotfList("Themes");
$("lotfFilterChars").onclick=()=>buildLotfList("Characters");
$("lotfFilterSymbol").onclick=()=>buildLotfList("Symbolism");
$("lotfPrint").onclick=()=>{window.print();};

/* ---------- Study: Shakespeare Q&A ---------- */
function buildShQA(){
  const wrap=$("shQA"); wrap.innerHTML="";
  SHAKESPEARE_QA.forEach(section=>{
    const h=document.createElement("h3"); h.textContent=section.section; wrap.appendChild(h);
    section.items.forEach((item)=>{
      const card=document.createElement("div"); card.className="card"; card.style.marginBottom="10px";
      card.innerHTML=`<div><b>${item.q}</b></div>
                      <div class="qa-a" style="display:none;margin-top:6px">${item.a}</div>
                      <div class="row" style="margin-top:8px"><button class="btn secondary btnShow">Show Answer</button></div>`;
      const btn=card.querySelector(".btnShow"), ans=card.querySelector(".qa-a");
      btn.addEventListener("click",()=>{
        const vis=ans.style.display!=="none"; ans.style.display=vis?"none":"block";
        btn.textContent=vis?"Show Answer":"Hide Answer"; beep("open");
      });
      wrap.appendChild(card);
    });
  });
}
$("shExpandAll").onclick=()=>{[...$("shQA").querySelectorAll(".qa-a")].forEach(a=>a.style.display="block");[...$("shQA").querySelectorAll(".btnShow")].forEach(b=>b.textContent="Hide Answer");beep("open");}
$("shCollapseAll").onclick=()=>{[...$("shQA").querySelectorAll(".qa-a")].forEach(a=>a.style.display="none");[...$("shQA").querySelectorAll(".btnShow")].forEach(b=>b.textContent="Show Answer");beep("open");}
$("shPrint").onclick=()=>{window.print();};
buildStudyTable(); buildLotfList("All"); buildShQA();

/* ----------------- ENGLISH DRIVER (Touch-friendly) ----------------- */
const drv = {
  cvs: $("drvCanvas"),
  ctx: $("drvCanvas").getContext("2d"),
  w: 380, h: 560,
  lanes: [90, 190, 290],
  player: {lane:1,y:480,width:36,height:56,color:"#00f5d4"},
  lines: [],
  speed: 50, pxPerSec: 200,
  running:false, last:0, meters:0, nextCheckpoint:500, score:0,
  pickup:null, overlay:$("drvOverlay")
};
function drvReset(){
  drv.player.lane=1; drv.player.y=480; drv.meters=0; drv.nextCheckpoint=500; drv.score=0; drv.pickup=null;
  drv.lines=[]; for(let i=0;i<12;i++)drv.lines.push({y:i*60});
  $("drvDist").textContent="0"; $("drvScore").textContent="0"; $("drvSpeed").textContent=drv.speed;
  drv.ctx.clearRect(0,0,drv.w,drv.h); drawRoad();
}
function drawRoad(){
  const c=drv.ctx; c.fillStyle="#0a0f21"; c.fillRect(0,0,drv.w,drv.h);
  c.fillStyle="#0f1837"; c.fillRect(40,0,drv.w-80,drv.h);
  c.strokeStyle="#cfe7ff"; c.lineWidth=3; c.setLineDash([18,18]);
  c.beginPath(); c.moveTo(drv.w/2,0); c.lineTo(drv.w/2,drv.h); c.stroke(); c.setLineDash([]);
  c.strokeStyle="#fca311"; c.lineWidth=6;
  drv.lines.forEach((ln)=>{c.beginPath(); c.moveTo(60,ln.y); c.lineTo(drv.w-60,ln.y); c.stroke();});
  drawCar(drv.lanes[drv.player.lane]-18, drv.player.y, drv.player.color);
  if(drv.pickup){drawCar(drv.lanes[drv.pickup.lane]-18, drv.pickup.y, "#ffffff");}
}
function drawCar(x,y,color){
  const c=drv.ctx;
  c.fillStyle=color; c.strokeStyle="#202a55"; c.lineWidth=2;
  roundRect(c,x,y,36,56,8,true,true);
  c.fillStyle="#061314"; c.fillRect(x+6,y+6,24,12);
}
function roundRect(ctx,x,y,w,h,r,fill,stroke){if(r> w/2)r=w/2;if(r>h/2)r=h/2;ctx.beginPath();ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y,h);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);ctx.closePath();if(fill)ctx.fill();if(stroke)ctx.stroke();}

function drvSpawnPickup(){drv.pickup={lane:Math.floor(Math.random()*3),y:-60};}
function drvUpdate(ts){
  if(!drv.running){drv.last=ts; return;}
  const dt=(ts-drv.last)/1000; drv.last=ts;
  drv.lines.forEach(ln=>{ln.y+=drv.pxPerSec*dt; if(ln.y>drv.h)ln.y-=drv.h;});
  drv.meters+=drv.speed*dt; if(drv.meters<0)drv.meters=0;
  $("drvDist").textContent=Math.floor(drv.meters);
  if(!drv.pickup && Math.random()<0.01){drvSpawnPickup();}
  if(drv.pickup){drv.pickup.y+=drv.pxPerSec*dt*0.9; if(drv.pickup.y>drv.h+60)drv.pickup=null;}
  if(drv.pickup && drv.pickup.lane===drv.player.lane && Math.abs(drv.pickup.y-drv.player.y)<40){drv.running=false; showDriverQuestion(true); drv.pickup=null;}
  if(drv.meters>=drv.nextCheckpoint){drv.running=false; showDriverQuestion(false); drv.nextCheckpoint+=500;}
  drawRoad(); requestAnimationFrame(drvUpdate);
}
function moveLeft(){drv.player.lane=Math.max(0,drv.player.lane-1);beep("open");drawRoad();}
function moveRight(){drv.player.lane=Math.min(2,drv.player.lane+1);beep("open");drawRoad();}
$("drvLeft").addEventListener("touchstart",e=>{e.preventDefault();moveLeft();});
$("drvRight").addEventListener("touchstart",e=>{e.preventDefault();moveRight();});
$("drvLeft").addEventListener("click",moveLeft); $("drvRight").addEventListener("click",moveRight);
let touchX=null;
$("drvCanvas").addEventListener("touchstart",e=>{touchX=e.touches[0].clientX;});
$("drvCanvas").addEventListener("touchend",e=>{if(touchX===null)return; const dx=(e.changedTouches[0].clientX-touchX); if(dx<-20) moveLeft(); else if(dx>20) moveRight(); touchX=null;});

function startDriver(){drvReset(); drv.running=true; drv.last=performance.now(); requestAnimationFrame(drvUpdate);}
function pauseDriver(){drv.running=false;}
$("drvStart").onclick=()=>{startDriver();};
$("drvPause").onclick=()=>{pauseDriver();};

function showDriverQuestion(isBonus){
  const overlay=$("drvOverlay"); overlay.style.display="flex";
  const pool=shuffle(TOPIC_TEST_MCQ.slice()); const q=pool[0]; $("drvQ").textContent=(isBonus?"Bonus ‚Äî ":"")+q.q;
  const wrap=$("drvOpts"); wrap.innerHTML="";
  shuffle(q.options.slice()).forEach(opt=>{
    const b=document.createElement("button"); b.className="btn secondary"; b.textContent=opt;
    b.onclick=()=>{
      if(opt===q.correct){
        overlay.style.display="none";
        const add=isBonus?200:100;
        drv.score+=add; $("drvScore").textContent=drv.score;
        confettiBurst(isBonus?"+Bonus!":"Correct!");
        drv.running=true; drv.last=performance.now(); requestAnimationFrame(drvUpdate);
        STATS.driver.bestMeters=Math.max(STATS.driver.bestMeters,Math.floor(drv.meters)); saveStats(STATS);
      }else{ thumbsDown("Incorrect ‚Äî try again"); }
    };
    wrap.appendChild(b);
  });
}

/* ---------- initialise ---------- */
$("btnQuickPlay").onclick=()=>document.querySelector('.tab-btn[data-tab="hangman"]').click();
buildStudyTable(); buildLotfList("All"); buildShQA();
const studentLast=getLastStudent(); if(studentLast){$("studentBadge").textContent=`${studentLast.name||"Guest"} ${studentLast.surname||""} ¬∑ ${studentLast.class||"‚Äî"}`;}
drvReset();
</script>
</body>
</html>
