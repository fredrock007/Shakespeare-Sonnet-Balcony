<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="Cache-Control" content="no-store, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mr Samuels‚Äô Grade 10 English Hub</title>
<style>
  :root{
    --bg:#070b1a; --panel:rgba(14,18,36,.72);
    --text:#e7f2ff; --muted:#a8bfdd;
    --accent:#00f5d4; --accent2:#ff5e57; --accent3:#8a5cff; --accent4:#fca311;
    --good:#2ecc71; --bad:#ff4d6d;
    --theme:#8a5cff; /* changes per category in Millionaire & overlays */
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 10% -10%,#102153 0,#0c1736 30%,#070b1a 65%) fixed;color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:1220px;margin:0 auto;padding:20px}
  header{display:flex;align-items:center;gap:10px;margin-bottom:14px;position:relative}
  .brand{font-weight:900;font-size:24px}
  .neon{background:linear-gradient(90deg,var(--accent),var(--accent3));-webkit-background-clip:text;background-clip:text;color:transparent}
  .tabs{margin-left:auto;display:flex;flex-wrap:wrap;gap:10px}
  .tab-btn{border:1px solid rgba(255,255,255,.08);padding:10px 14px;border-radius:999px;background:linear-gradient(180deg,#121a38,#0d1430);color:#e7f2ff;cursor:pointer}
  .tab-btn.active{color:#061314;background:linear-gradient(180deg,var(--accent) 0,var(--accent3) 100%);font-weight:800;box-shadow:0 0 24px rgba(0,245,212,.25)}
  .badge{background:linear-gradient(90deg,var(--accent3),var(--accent2));padding:6px 10px;border-radius:999px;font-size:12px}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,.2)}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#101a34;border:1px solid rgba(255,255,255,.08);color:#a8bfdd;font-size:12px}
  .btn{border:0;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;color:#061314;background:linear-gradient(180deg,var(--accent) 0,var(--accent3) 100%);box-shadow:0 6px 22px rgba(138,92,255,.25)}
  .btn.secondary{color:#cfe7ff;background:linear-gradient(180deg,#1b2546 0,#121c3a 100%);border:1px solid rgba(255,255,255,.08)}
  .btn.warn{color:#130a00;background:linear-gradient(180deg,#ffd166 0,var(--accent4) 100%)}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .card{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:16px}
  .flex{display:flex;gap:16px;flex-wrap:wrap}.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}.grow{flex:1 1 360px}
  .muted{color:var(--muted)} .big{font-size:18px}
  .grid-2{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
  @media (max-width:980px){.grid-2{grid-template-columns:1fr}}
  .statgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  @media (max-width:900px){.statgrid{grid-template-columns:repeat(2,1fr)}}
  .stat{background:linear-gradient(180deg,#101837,#0c1330);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px}
  .stat h4{margin:0 0 6px 0;font-size:12px;color:#bcd1ff}.stat .v{font-size:24px;font-weight:900}

  /* Hangman */
  .hm-title{font-weight:800;margin:0 0 8px 0}
  canvas{background:linear-gradient(180deg,#0c1228,#0a0f21);border:1px solid rgba(255,255,255,.1);border-radius:16px;max-width:100%}
  .slots{letter-spacing:.28em;font-size:26px;margin:10px 0 6px;white-space:pre}
  .kbd{display:grid;grid-template-columns:repeat(10,1fr);gap:6px;margin-top:12px}
  .key{background:linear-gradient(180deg,#131e41,#101936);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:10px 0;text-align:center;font-weight:700;cursor:pointer;color:#cfe7ff}
  .key.used{opacity:.35;pointer-events:none}
  .hint{background:linear-gradient(180deg,#0f1837,#0b1230);border:1px solid rgba(255,255,255,.08);padding:10px;border-radius:10px}
  .good{color:var(--good)} .bad{color:var(--bad)}

  /* 30 Seconds */
  input[type="text"]{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:linear-gradient(180deg,#0c1530,#0a1126);color:#e6eef5;font-size:16px}
  .def-box{font-size:18px;line-height:1.45}.hourglass{width:58px;height:90px}.sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0)}

  /* Millionaire */
  #million{border:1px solid rgba(255,255,255,.08); border-radius:18px; background:linear-gradient(180deg,#0f1836,#0b1230);}
  #million.theming{box-shadow:0 0 0 3px var(--theme) inset, 0 0 28px rgba(255,255,255,.04);}
  .mil-cat{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.15);background:linear-gradient(180deg,#0f1837,#0b1230)}
  .mil-dot{width:10px;height:10px;border-radius:50%}

  .ladder{list-style:none;padding:0;margin:0;display:flex;flex-direction:column-reverse;gap:6px}
  .ladder li{padding:8px 10px;border:1px solid rgba(255,255,255,.12);border-radius:12px;background:linear-gradient(180deg,#0f1836,#0b1230);font-weight:700;display:flex;justify-content:space-between}
  .ladder li.active{background:linear-gradient(90deg,rgba(0,245,212,.35),rgba(138,92,255,.35));border-color:var(--accent);color:#e9fcff}
  .opt{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
  .opt button{padding:12px;border-radius:12px;border:2px solid rgba(255,255,255,.12);background:linear-gradient(180deg,#10193a,#0d1633);color:#e6eef5;font-weight:800;cursor:pointer}

  /* Road Rage */
  .driver-wrap{display:grid;grid-template-columns:1fr;gap:10px}
  .driver-controls{display:flex;gap:10px;justify-content:center}
  .ctrl{width:120px;height:120px;border-radius:18px;border:2px solid rgba(255,255,255,.1);background:linear-gradient(180deg,#10193a,#0d1633);color:#e6eef5;font-size:22px;font-weight:900;touch-action:none}
  .ctrl:active{transform:scale(.98)} @media (max-width:600px){.ctrl{width:100px;height:100px;font-size:20px}}
  .hud{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  .overlayQ{position:absolute;inset:0;background:rgba(7,11,26,.8);display:none;align-items:center;justify-content:center;z-index:50}
  .overlayCard{max-width:560px;background:linear-gradient(180deg,#0f1837,#0b1230);border:2px solid var(--theme);border-radius:16px;padding:16px}
  .overlayCard .opt{grid-template-columns:1fr}
  .gameOver{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(5,0,0,.65);z-index:60;color:#ff1e1e;font-weight:900;font-size:44px;text-shadow:0 0 22px #300}

  /* Study */
  .subtabs{display:flex;gap:8px;margin-bottom:10px}
  .sub-btn{border:1px solid rgba(255,255,255,.1);padding:8px 12px;border-radius:999px;background:linear-gradient(180deg,#121a38,#0d1430);color:#cfe7ff;cursor:pointer}
  .sub-btn.active{color:#061314;background:linear-gradient(180deg,var(--accent2),var(--accent3));font-weight:800;box-shadow:0 0 18px rgba(255,94,87,.22)}
  table{width:100%;border-collapse:collapse}
  th,td{border:1px solid rgba(255,255,255,.08);padding:8px;vertical-align:top}
  th{background:linear-gradient(180deg,#0f1837,#0b1230)}

  /* Toast / Confetti */
  .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#0d1640;border:1px solid rgba(255,255,255,.12);color:#dff3ff;padding:10px 14px;border-radius:999px;opacity:0;transition:opacity .2s, transform .2s;pointer-events:none;z-index:150}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}
  .confetti-piece{position:fixed;top:0;left:0;width:8px;height:14px;opacity:.9;pointer-events:none;border-radius:2px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">Mr Samuels‚Äô <span class="neon">Grade 10 English Hub</span></div>
    <span id="studentBadge" class="badge">Guest Mode</span>
    <button id="btnStudent" class="tab-btn ghost">Set Student</button>
    <div class="tabs">
      <button class="tab-btn active" data-tab="dash">Dashboard</button>
      <button class="tab-btn" data-tab="hangman">Hangman</button>
      <button class="tab-btn" data-tab="seconds">30 Seconds</button>
      <button class="tab-btn" data-tab="million">Millionaire</button>
      <button class="tab-btn" data-tab="driver">Road Rage</button>
      <button class="tab-btn" data-tab="study">Study</button>
    </div>
  </header>

  <!-- DASHBOARD -->
  <section id="dash" class="card">
    <div class="statgrid">
      <div class="stat"><h4>Merits</h4><div class="v" id="s_merits">0</div></div>
      <div class="stat"><h4>Hangman Wins</h4><div class="v" id="s_hm_wins">0</div></div>
      <div class="stat"><h4>30 Seconds ‚Äî Fastest</h4><div class="v" id="s_30_fast">‚Äî</div></div>
      <div class="stat"><h4>30 Seconds ‚Äî Correct</h4><div class="v" id="s_30_total">0</div></div>
      <div class="stat"><h4>Millionaire ‚Äî Best Step</h4><div class="v" id="s_mil_best">0 / 15</div></div>
      <div class="stat"><h4>Millionaire ‚Äî Correct</h4><div class="v" id="s_mil_correct">0</div></div>
      <div class="stat"><h4>Millionaire ‚Äî Answered</h4><div class="v" id="s_mil_answered">0</div></div>
      <div class="stat"><h4>Road Rage ‚Äî Best Run</h4><div class="v" id="s_drv_best">0 m</div></div>
    </div>
  </section>

  <!-- HANGMAN -->
  <section id="hangman" class="card" style="display:none">
    <div class="flex">
      <div class="grow" style="max-width:480px">
        <h2 class="hm-title">Mr Samuels ‚Äì Grade 10 HL Hangman</h2>
        <canvas id="hmCanvas" width="430" height="280"></canvas>
      </div>
      <div class="grow">
        <div class="row">
          <span class="pill">Lives: <span id="lives">6</span></span>
          <span class="pill">Wins: <span id="wins">0</span></span>
        </div>
        <div id="slots" class="slots">_ _ _ _ _</div>
        <div id="used" class="muted">Used: ‚Äî</div>
        <div class="row" style="margin-top:8px">
          <button id="btnHint" class="btn secondary">Show Hint</button>
          <button id="btnNew" class="btn">New Word</button>
          <button id="btnReveal" class="btn warn">Reveal</button>
        </div>
        <div id="hint" class="hint" style="margin-top:10px;display:none"></div>
        <div id="result" class="big" style="margin-top:8px"></div>
        <div class="kbd" id="keyboard" style="margin-top:10px"></div>
      </div>
    </div>
  </section>

  <!-- 30 SECONDS -->
  <section id="seconds" class="card" style="display:none">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div class="pill">Round Score: <span id="secScore">0</span></div>
      <div class="row" style="gap:10px;align-items:center">
        <svg id="hourglass" viewBox="0 0 100 160" class="hourglass" aria-label="Timer">
          <defs><clipPath id="clipTop"><polygon points="20,20 80,20 50,80"/></clipPath>
                 <clipPath id="clipBottom"><polygon points="20,140 80,140 50,80"/></clipPath></defs>
          <rect id="hgTop" x="20" y="20" width="60" height="60" fill="#fca311" clip-path="url(#clipTop)"/>
          <rect id="hgBottom" x="20" y="140" width="60" height="0" fill="#fca311" clip-path="url(#clipBottom)"/>
          <rect id="hgStream" x="48.5" y="78" width="3" height="0" fill="#fca311" visibility="hidden"/>
          <polygon points="20,20 80,20 50,80 20,140 80,140 50,80" fill="none" stroke="#cfe7ff" stroke-width="4"/>
          <rect x="15" y="10" width="70" height="8" fill="#cfe7ff"/><rect x="15" y="142" width="70" height="8" fill="#cfe7ff"/>
        </svg>
        <span id="secTime" class="sr-only">30</span>
      </div>
    </div>
    <div id="defBox" class="def-box" style="margin:10px 0 8px"></div>
    <input id="secInput" type="text" placeholder="Type the word here‚Ä¶" autocomplete="off" />
    <div class="row" style="margin-top:10px">
      <button id="secStart" class="btn">Start 30-second Round</button>
      <button id="secSkip" class="btn secondary" disabled>Skip</button>
      <button id="secGive" class="btn warn" disabled>Give Answer</button>
      <span class="pill">Correct total: <span id="secTotal">0</span></span>
    </div>
    <div id="secFeedback" class="big" style="margin-top:8px"></div>
    <div id="secLast" class="muted" style="margin-top:6px"></div>
  </section>

  <!-- MILLIONAIRE -->
  <section id="million" class="card theming" style="display:none">
    <div class="grid-2">
      <div>
        <div class="row" style="justify-content:space-between;align-items:center">
          <div class="pill">Question <span id="milStep">1</span>/15</div>
          <div class="row">
            <span class="mil-cat"><span class="mil-dot" id="milDot" style="background:var(--theme)"></span><b id="milCat">‚Äî</b></span>
            <button id="mil5050" class="btn secondary">50:50</button>
            <button id="milSkip" class="btn secondary">Skip</button>
            <button id="milQuit" class="btn warn">Quit</button>
          </div>
        </div>
        <div id="milQ" class="def-box" style="margin-top:10px;font-weight:700"></div>
        <div class="opt" id="milOpts" style="margin-top:10px"></div>
        <div id="milFeedback" class="big" style="margin-top:10px"></div>
        <div class="row" style="margin-top:10px"><button id="milStart" class="btn">Start New Game</button></div>
      </div>
      <div><ul class="ladder" id="milLadder"></ul></div>
    </div>
  </section>

  <!-- ROAD RAGE -->
  <section id="driver" class="card" style="display:none">
    <div class="driver-wrap">
      <div class="row hud" style="justify-content:space-between">
        <span class="pill">Distance: <b id="drvDist">0</b> m</span>
        <span class="pill">Speed: <b id="drvSpeed">50</b> m/s</span>
        <span class="pill">Score: <b id="drvScore">0</b></span>
        <span class="pill">Lives: <b id="drvLives">3</b></span>
        <button id="drvStart" class="btn">Start Run</button>
        <button id="drvPause" class="btn secondary">Pause</button>
      </div>
      <div style="position:relative;display:flex;justify-content:center">
        <canvas id="drvCanvas" width="360" height="540" style="border-radius:16px;border:1px solid rgba(255,255,255,.1)"></canvas>
        <div id="drvOverlay" class="overlayQ">
          <div class="overlayCard">
            <div class="big" id="drvQ">Question here</div>
            <div id="drvOpts" class="opt" style="margin-top:10px"></div>
          </div>
        </div>
        <div id="drvGameOver" class="gameOver">GAME OVER</div>
      </div>
      <div class="driver-controls">
        <button id="drvLeft" class="ctrl">‚üµ<br/><small>LEFT</small></button>
        <button id="drvRight" class="ctrl">‚ü∂<br/><small>RIGHT</small></button>
      </div>
    </div>
  </section>

  <!-- STUDY -->
  <section id="study" class="card" style="display:none">
    <div class="subtabs">
      <button class="sub-btn active" data-sub="studyVocab">Vocabulary</button>
      <button class="sub-btn" data-sub="lotf">Lord of the Flies</button>
      <button class="sub-btn" data-sub="shakespeare">Shakespeare</button>
    </div>

    <div id="studyVocab">
      <div class="row">
        <input id="studySearch" type="text" placeholder="Search word/definition/example‚Ä¶">
        <button id="studyReset" class="btn secondary">Clear</button>
        <button id="studyPrint" class="btn">Print</button>
      </div>
      <div style="overflow:auto; max-height:60vh; margin-top:8px">
        <table id="studyTable"><thead><tr><th style="width:18%">Word</th><th style="width:37%">Definition</th><th>Example sentence</th></tr></thead><tbody></tbody></table>
      </div>
    </div>

    <div id="lotf" style="display:none">
      <div class="row">
        <button class="btn secondary" id="lotfAll">All</button>
        <button class="btn secondary" id="lotfPlot">Plot</button>
        <button class="btn secondary" id="lotfThemes">Themes</button>
        <button class="btn secondary" id="lotfChars">Characters</button>
        <button class="btn secondary" id="lotfSymbol">Symbolism</button>
        <button class="btn" id="lotfPrint">Print</button>
      </div>
      <div id="lotfList" style="max-height:60vh; overflow:auto; margin-top:8px"></div>
    </div>

    <div id="shakespeare" style="display:none">
      <div class="card" style="margin-bottom:10px">
        <div class="big"><b>Shakespeare Study Pack</b> ‚Äî <b>Sonnet 18</b> & <b>Romeo and Juliet</b> (renumbered Q&A), plus <b>MCQ Practice</b> and <b>Short Answer Practice (with model answers)</b>.</div>
      </div>
      <div id="shQA" style="max-height:26vh; overflow:auto; margin-bottom:10px;"></div>
      <h3>MCQ Practice</h3>
      <div id="shMCQ" style="max-height:24vh; overflow:auto; margin-bottom:10px;"></div>
      <h3>Short Answer Practice (with model answers)</h3>
      <div id="shSA" style="max-height:26vh; overflow:auto;"></div>
      <div class="row" style="margin-top:8px">
        <button id="shExpandAll" class="btn secondary">Expand all</button>
        <button id="shCollapseAll" class="btn secondary">Collapse all</button>
        <button id="shPrint" class="btn">Print</button>
      </div>
    </div>
  </section>
</div>

<div class="toast" id="toast">Saved</div>

<script>
/* ===== Polyfills ===== */
window.requestAnimationFrame = window.requestAnimationFrame || function(cb){return setTimeout(function(){cb(Date.now());},16);};
NodeList.prototype.forEach = NodeList.prototype.forEach || Array.prototype.forEach;

/* ===== Audio (UI + fanfare) ===== */
var AC;
function tone(f,d,type,g){try{
  AC=AC||new(window.AudioContext||window.webkitAudioContext)();
  var o=AC.createOscillator(), v=AC.createGain();
  o.type=type; o.frequency.value=f; o.connect(v); v.connect(AC.destination);
  var t=AC.currentTime; v.gain.setValueAtTime(0.0001,t);
  v.gain.exponentialRampToValueAtTime(g||0.18,t+0.01);
  v.gain.exponentialRampToValueAtTime(0.0001,t+(d||0.2));
  o.start(t); o.stop(t+(d||0.2)+0.02);
}catch(e){}}
function fanfare(){
  try{
    AC=AC||new(window.AudioContext||window.webkitAudioContext)();
    var t=AC.currentTime, seq=[
      {f:392,d:.16,type:"triangle"},{f:523,d:.16,type:"triangle"},{f:659,d:.16,type:"triangle"},
      {f:784,d:.28,type:"triangle"},
      {f:0,d:.08},{f:784,d:.16},{f:659,d:.16},{f:523,d:.16},{f:392,d:.28}
    ];
    var at=t;
    seq.forEach(function(n){ if(n.f>0){var o=AC.createOscillator(), g=AC.createGain();o.type=n.type;o.frequency.value=n.f;o.connect(g);g.connect(AC.destination);g.gain.setValueAtTime(0.0001,at);g.gain.exponentialRampToValueAtTime(0.22,at+0.01);g.gain.exponentialRampToValueAtTime(0.0001,at+n.d);o.start(at);o.stop(at+n.d+0.02);} at+=n.d;});
  }catch(e){}
}
function beep(kind){var m={ui:[420,0.09,"sine",0.12],open:[560,0.12,"triangle",0.14],ok:[660,0.18,"triangle",0.2],wrong:[200,0.18,"sawtooth",0.2],win:[880,0.25,"triangle",0.22],time:[300,0.18,"sine",0.18]};
  var s=m[kind||"ui"]; tone(s[0],s[1],s[2],s[3]); }
addEventListener("click",function(e){var el=e.target;if(el.closest&&(el.closest("button")||el.closest(".tab-btn")||el.closest(".sub-btn"))) beep("ui");});

/* ===== Helpers ===== */
function $(id){return document.getElementById(id);}
function toast(msg){var t=$("toast");t.textContent=msg;t.classList.add("show");setTimeout(function(){t.classList.remove("show");},1200);}
function confetti(msg){for(var i=0;i<40;i++){var p=document.createElement("div");p.className="confetti-piece";p.style.background=["#00f5d4","#8a5cff","#ff5e57","#fca311","#2ecc71"][Math.floor(Math.random()*5)];p.style.left=(50+Math.random()*40-20)+"%";p.style.top="60%";p.style.transition="transform 1s ease-out, opacity 1.2s";document.body.appendChild(p);(function(p){setTimeout(function(){var dx=(Math.random()*2-1)*200,dy=-(200+Math.random()*300);p.style.transform="translate("+dx+"px,"+dy+"px) rotate("+Math.random()*360+"deg)";p.style.opacity=0;},10);setTimeout(function(){p.remove();},1200);})(p);}toast("üéâ "+msg);beep("win");}
function thumbsDown(msg){toast("üëé "+(msg||"Try again"));beep("wrong");}

/* ===== Core Data ===== */
var CAT_COLORS={
  "Sonnet 18":"#ff4d6d",
  "Romeo & Juliet ‚Äì Balcony":"#fca311",
  "Lord of the Flies":"#2ecc71",
  "Literary Devices":"#8a5cff",
  "Parts of Speech":"#4da3ff"
};

var TERMS=[
 {w:"sonnet",d:"A 14-line poem with a specific rhyme scheme.",e:"Shakespeare‚Äôs Sonnet 18 is a sonnet in iambic pentameter."},
 {w:"iambic pentameter",d:"A rhythm of five iambs per line.",e:"'Shall I compare thee' scans in iambic pentameter."},
 {w:"metaphor",d:"Direct comparison without 'like' or 'as'.",e:"'Eye of heaven' is a metaphor for the sun."},
 {w:"personification",d:"Human traits to non-human things.",e:"'Death brag' personifies death."},
 {w:"oxymoron",d:"Contradictory terms together.",e:"'Brawling love' in Romeo and Juliet."},
 {w:"soliloquy",d:"Speech revealing inner thoughts.",e:"Juliet‚Äôs Act 3 soliloquy shows her anxiety."},
 {w:"dramatic irony",d:"Audience knows more than characters.",e:"We know Juliet isn‚Äôt dead; Romeo doesn‚Äôt."},
 {w:"symbolism",d:"Objects/actions representing ideas.",e:"The conch symbolises order."},
 {w:"microcosm",d:"Small system mirroring a larger one.",e:"The island is a microcosm of society."}
];

var LOTF_NOTES=[
 {type:"Plot",text:"British schoolboys stranded on an island; Ralph elected; Jack hunts; fear and savagery rise; Simon and Piggy die; rescue with a naval officer."},
 {type:"Themes",text:"Civilisation vs Savagery; Loss of Innocence; Power; Fear and the 'Beast'."},
 {type:"Characters",text:"Ralph (order/rescue), Piggy (reason), Jack (authoritarian), Simon (spiritual good), Roger (sadism)."},
 {type:"Symbolism",text:"Conch (order), Signal Fire (hope), Glasses (science), Painted Faces (anonymity), Lord of the Flies (evil within)."}
];

/* Study: short-answer items (model answers) ‚Äî renamed (no 'Topic Test' wording) */
var SHAKESPEARE_SA = [
  { section: "SECTION A: POETRY ‚Äî Sonnet 18", items: [
    {q:"To whom is the speaker comparing the subject in line 1?", a:"A summer‚Äôs day."},
    {q:"Identify and explain 'the eye of heaven'.", a:"Metaphor (and personification) for the sun; it can be too hot, showing summer‚Äôs flaws."},
    {q:"Quote two consecutive words that show summer is temporary.", a:"‚Äúshort date‚Äù (from 'summer‚Äôs lease hath all too short a date')."},
    {q:"How does the poet immortalise the subject?", a:"Through 'eternal lines'; poetry preserves the beloved as long as it is read."}
  ]},
  { section: "SECTION B: DRAMA ‚Äî Romeo & Juliet (Balcony Scene)", items: [
    {q:"Meaning of 'Wherefore art thou Romeo?'", a:"'Why must you be Romeo (a Montague)?' Not 'Where are you?'."},
    {q:"What conflict does Juliet face here?", a:"Love versus family name/loyalty."},
    {q:"'I'll be new baptised' ‚Äî what does this reveal about Romeo?", a:"Impulsive and willing to change identity for love."}
  ]},
  { section: "SECTION B: DRAMA ‚Äî Romeo & Juliet (Friar Laurence)", items: [
    {q:"Why is the Friar surprised by Romeo‚Äôs request?", a:"Romeo rapidly shifts from Rosaline to Juliet; seems fickle."},
    {q:"Is the Friar‚Äôs decision to help wise? Motivate.", a:"Arguably not; although he hopes to end the feud, the haste contributes to tragedy."}
  ]}
];

/* Unified MCQ bank (category-tagged). Used by Millionaire + Road Rage + Study MCQ. */
var MCQ = [
  /* Sonnet 18 */
  {cat:"Sonnet 18",q:"In Sonnet 18, the beloved is compared to a‚Ä¶",options:["Summer‚Äôs day","Winter‚Äôs night","Stormy sea","Rose"],correct:"Summer‚Äôs day"},
  {cat:"Sonnet 18",q:"'Summer‚Äôs lease' suggests summer is‚Ä¶",options:["Temporary","Perfect","Eternal","Rainy"],correct:"Temporary"},
  {cat:"Sonnet 18",q:"'Eye of heaven' refers to the‚Ä¶",options:["Sun","Moon","Gods","Sky"],correct:"Sun"},
  {cat:"Sonnet 18",q:"The beloved‚Äôs beauty lives on through‚Ä¶",options:["Eternal lines","Painting","Statue","Diary"],correct:"Eternal lines"},

  /* Romeo & Juliet ‚Äì Balcony */
  {cat:"Romeo & Juliet ‚Äì Balcony",q:"'Wherefore art thou Romeo?' means‚Ä¶",options:["Why are you Romeo?","Where are you?","Who are you?","When are you coming?"],correct:"Why are you Romeo?"},
  {cat:"Romeo & Juliet ‚Äì Balcony",q:"Juliet‚Äôs central conflict is with‚Ä¶",options:["Family loyalty","Money","Fame","Travel"],correct:"Family loyalty"},
  {cat:"Romeo & Juliet ‚Äì Balcony",q:"Friar warns sudden passions‚Ä¶",options:["Can end badly","Are best","Never change","Always last"],correct:"Can end badly"},

  /* Lord of the Flies */
  {cat:"Lord of the Flies",q:"What does the conch symbolise?",options:["Order and speech","Wealth","Romance","Religion"],correct:"Order and speech"},
  {cat:"Lord of the Flies",q:"Who is elected leader first?",options:["Ralph","Jack","Piggy","Simon"],correct:"Ralph"},
  {cat:"Lord of the Flies",q:"Piggy‚Äôs glasses symbolise‚Ä¶",options:["Reason and science","Beauty","War","Tradition"],correct:"Reason and science"},
  {cat:"Lord of the Flies",q:"Who kills Piggy?",options:["Roger","Jack","Ralph","Officer"],correct:"Roger"},
  {cat:"Lord of the Flies",q:"The 'beast' ultimately represents‚Ä¶",options:["Inner savagery","A monster","A boar","A spirit"],correct:"Inner savagery"},
  {cat:"Lord of the Flies",q:"Why do the boys paint their faces?",options:["Anonymity/savagery","Warmth","Respect","Religion"],correct:"Anonymity/savagery"},
  {cat:"Lord of the Flies",q:"Shattering the conch means‚Ä¶",options:["Collapse of order","More equality","Festival","Rescue"],correct:"Collapse of order"},
  {cat:"Lord of the Flies",q:"What keeps hope of rescue alive?",options:["Signal fire","Hunting","Shelters","Chanting"],correct:"Signal fire"},
  {cat:"Lord of the Flies",q:"Who represents spiritual goodness?",options:["Simon","Roger","Jack","Samneric"],correct:"Simon"},
  {cat:"Lord of the Flies",q:"'Lord of the Flies' (pig‚Äôs head) symbolises‚Ä¶",options:["Evil within","Royalty","Salvation","Wealth"],correct:"Evil within"},

  /* Literary Devices */
  {cat:"Literary Devices",q:"A 14-line poem with a set rhyme scheme is a‚Ä¶",options:["Sonnet","Ode","Elegy","Ballad"],correct:"Sonnet"},
  {cat:"Literary Devices",q:"'Eye of heaven' is a‚Ä¶",options:["Metaphor","Simile","Onomatopoeia","Pun"],correct:"Metaphor"},
  {cat:"Literary Devices",q:"'Brawling love' (R&J) is an example of‚Ä¶",options:["Oxymoron","Metaphor","Onomatopoeia","Pun"],correct:"Oxymoron"},
  {cat:"Literary Devices",q:"Iambic pentameter has‚Ä¶",options:["Five iambs","Three trochees","Seven feet","Free rhythm"],correct:"Five iambs"},

  /* Parts of Speech */
  {cat:"Parts of Speech",q:"In 'The bright sun smiles', the word 'bright' is a‚Ä¶",options:["Adjective","Adverb","Noun","Verb"],correct:"Adjective"},
  {cat:"Parts of Speech",q:"In 'She quickly ran', 'quickly' is an‚Ä¶",options:["Adverb","Adjective","Preposition","Interjection"],correct:"Adverb"}
];

/* ===== Simple Stats ===== */
var KEY="g10_hub_v7";
function safeGet(k){try{return localStorage.getItem(k);}catch(e){return null}}
function safeSet(k,v){try{localStorage.setItem(k,v);}catch(e){}}
var STATS={merits:0,hangman:{wins:0},seconds:{fastest:null,total:0},million:{best:0,correct:0,answered:0},driver:{bestMeters:0}};
try{var s=safeGet(KEY);if(s){STATS=JSON.parse(s);} }catch(e){}
function saveStats(){safeSet(KEY,JSON.stringify(STATS));}
function refreshDash(){ $("s_merits").textContent=STATS.merits; $("s_hm_wins").textContent=STATS.hangman.wins;
  $("s_30_total").textContent=STATS.seconds.total; $("s_30_fast").textContent=STATS.seconds.fastest?(STATS.seconds.fastest/1000).toFixed(2)+"s":"‚Äî";
  $("s_mil_best").textContent=STATS.million.best+" / 15"; $("s_mil_correct").textContent=STATS.million.correct; $("s_mil_answered").textContent=STATS.million.answered;
  $("s_drv_best").textContent=STATS.driver.bestMeters+" m";
} refreshDash();

/* ===== Tabs ===== */
document.querySelectorAll(".tab-btn").forEach(function(b){
  b.addEventListener("click",function(){
    document.querySelectorAll(".tab-btn").forEach(function(x){x.classList.remove("active");});
    b.classList.add("active");
    var t=b.getAttribute("data-tab");
    document.querySelectorAll("section").forEach(function(s){s.style.display="none";});
    $(t).style.display="";
    if(t!=="driver"){RoadRage.pause();}
    beep("open");
  });
});
document.querySelectorAll(".sub-btn").forEach(function(b){
  b.addEventListener("click",function(){
    document.querySelectorAll(".sub-btn").forEach(function(x){x.classList.remove("active");});
    b.classList.add("active");
    var t=b.getAttribute("data-sub");
    ["studyVocab","lotf","shakespeare"].forEach(function(id){$(id).style.display=(id===t)?"":"none";});
  });
});

/* ===== Hangman ===== */
var hmWord="",hmMask=[],hmLives=6,hmUsed={},hmHint="",hmWins=0;
var hcv=$("hmCanvas"),hctx=hcv.getContext("2d");
function hmGallows(){hctx.clearRect(0,0,hcv.width,hcv.height);hctx.strokeStyle="#cfe7ff";hctx.lineWidth=4;
  hctx.beginPath();hctx.moveTo(40,250);hctx.lineTo(200,250);hctx.stroke();
  hctx.beginPath();hctx.moveTo(80,250);hctx.lineTo(80,50);hctx.lineTo(260,50);hctx.lineTo(260,80);hctx.stroke();
  hctx.beginPath();hctx.moveTo(260,80);hctx.lineTo(260,105);hctx.stroke();}
function hmPart(n){hctx.strokeStyle="#fca311";hctx.lineWidth=4;
  if(n===1){hctx.beginPath();hctx.arc(260,120,16,0,Math.PI*2);hctx.stroke();}
  if(n===2){hctx.beginPath();hctx.moveTo(260,136);hctx.lineTo(260,182);hctx.stroke();}
  if(n===3){hctx.beginPath();hctx.moveTo(260,146);hctx.lineTo(238,166);hctx.stroke();}
  if(n===4){hctx.beginPath();hctx.moveTo(260,146);hctx.lineTo(282,166);hctx.stroke();}
  if(n===5){hctx.beginPath();hctx.moveTo(260,182);hctx.lineTo(245,212);hctx.stroke();}
  if(n===6){hctx.beginPath();hctx.moveTo(260,182);hctx.lineTo(275,212);hctx.stroke();}}
function hmDraw(m){hmGallows();for(var i=1;i<=m&&i<=6;i++)hmPart(i);}
function hmKeyboard(){var kb=$("keyboard");kb.innerHTML="";"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(function(ch){var b=document.createElement("button");b.className="key";b.textContent=ch;b.onclick=function(){hmGuess(ch)};kb.appendChild(b);});}
function hmNew(){var pick=TERMS[Math.floor(Math.random()*TERMS.length)];hmWord=pick.w.toUpperCase();hmHint=pick.d;
  hmMask=hmWord.split("").map(function(c){return /[A-Z]/.test(c)?"_":c;}); hmLives=6; hmUsed={};
  $("slots").textContent=hmMask.join(" "); $("lives").textContent=hmLives; $("used").textContent="Used: ‚Äî";
  $("hint").style.display="none"; $("hint").textContent="Hint: "+hmHint; $("result").textContent=""; 
  document.querySelectorAll(".key").forEach(function(k){k.classList.remove("used");}); hmDraw(0);
}
function hmReveal(){ $("slots").textContent=hmWord.split("").join(" "); $("result").innerHTML="Answer: <b>"+hmWord+"</b>";}
function hmGuess(L){ if(hmLives<=0 || hmUsed[L])return; hmUsed[L]=1;
  document.querySelectorAll(".key").forEach(function(k){ if(k.textContent===L)k.classList.add("used");});
  $("used").textContent="Used: "+Object.keys(hmUsed).join(" ");
  if(hmWord.indexOf(L)>-1){ for(var i=0;i<hmWord.length;i++){ if(hmWord[i]===L) hmMask[i]=L; }
    $("slots").textContent=hmMask.join(" "); beep("ok");
    if(hmMask.join("").indexOf("_")===-1){ $("result").innerHTML="<span class='good'>Great! You solved it.</span>";
      hmWins++; $("wins").textContent=hmWins; STATS.hangman.wins++; saveStats(); refreshDash(); confetti("Hangman solved!"); }
  }else{ hmLives--; $("lives").textContent=hmLives; hmDraw(6-hmLives); if(hmLives<=0){$("result").innerHTML="<span class='bad'>Out of lives!</span> The word was <b>"+hmWord+"</b>";}
    else {thumbsDown("Wrong letter"); }}
}
hmKeyboard(); hmNew(); $("btnHint").onclick=function(){var el=$("hint"); el.style.display=el.style.display==="none"?"":"none";};
$("btnNew").onclick=hmNew; $("btnReveal").onclick=hmReveal;

/* ===== 30 Seconds ===== */
var secActive=false,secTime=30,secTimer=null,secScore=0,secQueue=[],secCurrent=null,secStart=null;
function hg(){var HG=60,prog=1-(secTime/30),topH=(1-prog)*HG,bottomH=prog*HG;
  $("hgTop").setAttribute("height",topH.toFixed(2)); $("hgBottom").setAttribute("y",(140-bottomH).toFixed(2)); $("hgBottom").setAttribute("height",bottomH.toFixed(2));
  var s=$("hgStream"); if(secActive&&secTime>0&&secTime<30){var len=8+34*prog; s.setAttribute("y",(80-len).toFixed(2)); s.setAttribute("height",len.toFixed(2)); s.setAttribute("visibility","visible");}
  else s.setAttribute("visibility","hidden"); }
function secReset(){secActive=false;secTime=30;secScore=0;secQueue=TERMS.slice();$("secScore").textContent=0;$("secFeedback").textContent="";$("defBox").innerHTML="Press <b>Start</b> to begin."; $("secInput").disabled=true; $("secSkip").disabled=true; $("secGive").disabled=true; hg();}
function secNext(){ if(secQueue.length===0)secQueue=TERMS.slice(); secCurrent=secQueue[Math.floor(Math.random()*secQueue.length)];
  $("defBox").innerHTML="<b>Definition:</b> "+secCurrent.d; $("secInput").value=""; $("secInput").focus(); secStart=Date.now(); }
function secStartRound(){ if(secActive)return; secReset(); secActive=true; $("secInput").disabled=false; $("secSkip").disabled=false; $("secGive").disabled=false; secNext();
  secTimer=setInterval(function(){secTime--; if(secTime<=0){clearInterval(secTimer); secActive=false; $("secFeedback").innerHTML="‚è±Ô∏è Round over. Score <b>"+secScore+"</b>."; beep("time");} hg();},1000);}
$("secStart").onclick=secStartRound; $("secSkip").onclick=function(){if(secActive)secNext();}; $("secGive").onclick=function(){if(secActive){$("secLast").innerHTML="Answer: <b>"+secCurrent.w+"</b>"; secNext();}};
$("secInput").addEventListener("keydown",function(e){ if(e.key==="Enter" && secActive){ var g=this.value.trim().toLowerCase();
  if(g===secCurrent.w.toLowerCase()){secScore++;$("secScore").textContent=secScore; STATS.seconds.total++; var t=Date.now()-secStart; if(!STATS.seconds.fastest||t<STATS.seconds.fastest)STATS.seconds.fastest=t; saveStats(); refreshDash(); confetti("Correct!"); secNext();}
  else{ thumbsDown("Incorrect"); }}}); secReset();

/* ===== Millionaire (with categories, theming, fanfare) ===== */
var ladder=["R 1 000 000","R 500 000","R 250 000","R 125 000","R 64 000","R 32 000","R 16 000","R 8 000","R 4 000","R 2 000","R 1 000","R 500","R 300","R 200","R 100"];
function buildLadder(){var ul=$("milLadder");ul.innerHTML="";for(var i=0;i<ladder.length;i++){var li=document.createElement("li");li.innerHTML="<span>"+(ladder.length-i)+"</span><span>"+ladder[i]+"</span>";ul.appendChild(li);} }
buildLadder();
var milIndex=0,milSet=[],milUsed5050=false,milUsedSkip=false,milActive=false, milCat="";
function setLadderActive(){var items=[].slice.call($("milLadder").children);items.forEach(function(li){li.classList.remove("active")});var pos=ladder.length-milIndex;if(items[pos-1])items[pos-1].classList.add("active");}
function applyTheme(cat){ milCat=cat||"‚Äî"; $("milCat").textContent=milCat; var col=CAT_COLORS[milCat]||"#8a5cff"; document.documentElement.style.setProperty("--theme",col); $("milDot").style.background=col; }
function milPrepare(){milIndex=0;milSet=MCQ.slice().sort(function(){return Math.random()-0.5;}).slice(0,15);milUsed5050=false;milUsedSkip=false;milActive=true;$("milStep").textContent="1";$("milFeedback").textContent="";$("mil5050").disabled=false;$("milSkip").disabled=false;applyTheme(milSet[0].cat);fanfare();milRender();}
function milRender(){var q=milSet[milIndex]; if(q.cat!==milCat) applyTheme(q.cat);
  $("milQ").innerHTML=q.q; var w=$("milOpts"); w.innerHTML="";
  q.options.slice().sort(function(){return Math.random()-0.5;}).forEach(function(opt,i){var b=document.createElement("button");b.dataset.opt=opt;b.innerHTML="<span style='opacity:.8'>"+String.fromCharCode(65+i)+")</span> "+opt;b.onclick=function(){milCheck(opt,b)};w.appendChild(b);});
  setLadderActive();
}
function milCheck(choice,btn){var q=milSet[milIndex],buttons=[].slice.call($("milOpts").querySelectorAll("button"));buttons.forEach(function(b){b.disabled=true;});
  STATS.million.answered++; if(choice===q.correct){STATS.million.correct++; btn.style.borderColor= "#2ecc71"; confetti("Correct!");
    milIndex++; STATS.million.best=Math.max(STATS.million.best,milIndex); saveStats(); refreshDash();
    if(milIndex>=milSet.length){$("milFeedback").innerHTML="üèÜ <b>Well done!</b>"; milActive=false; return;}
    $("milStep").textContent=String(milIndex+1); setTimeout(milRender,380);
  }else{ btn.style.borderColor="#ff4d6d"; thumbsDown("Incorrect"); var cbtn=buttons.filter(function(b){return b.dataset.opt===q.correct;})[0]; if(cbtn)cbtn.style.borderColor="#2ecc71";
    $("milFeedback").innerHTML="Category: <b>"+q.cat+"</b> ‚Äî Answer: <b>"+q.correct+"</b>"; milActive=false; saveStats(); refreshDash();
  }}
$("milStart").onclick=milPrepare;
$("mil5050").onclick=function(){if(milUsed5050)return;milUsed5050=true;this.disabled=true;var q=milSet[milIndex],buttons=[].slice.call($("milOpts").querySelectorAll("button"));buttons.filter(function(b){return b.dataset.opt!==q.correct;}).sort(function(){return Math.random()-0.5;}).slice(0,2).forEach(function(b){b.disabled=true;b.style.opacity=.4;});};
$("milSkip").onclick=function(){if(milUsedSkip)return;milUsedSkip=true;this.disabled=true;milIndex++;STATS.million.best=Math.max(STATS.million.best,milIndex);saveStats();refreshDash();if(milIndex>=milSet.length){$("milFeedback").innerHTML="You skipped to the end.";milActive=false;}else{$("milStep").textContent=String(milIndex+1);milRender();}};
$("milQuit").onclick=function(){milActive=false;$("milFeedback").textContent="Game ended.";};

/* ===== Study builders ===== */
function buildStudy(){var tb=$("studyTable").querySelector("tbody");tb.innerHTML="";TERMS.forEach(function(t){var tr=document.createElement("tr");tr.innerHTML="<td><b>"+t.w+"</b></td><td>"+t.d+"</td><td><em>"+t.e+"</em></td>";tb.appendChild(tr);});}
function filterStudy(){var q=$("studySearch").value.toLowerCase();[].slice.call($("studyTable").querySelectorAll("tbody tr")).forEach(function(r){r.style.display=r.textContent.toLowerCase().indexOf(q)>-1?"":"none";});}
$("studySearch").addEventListener("input",filterStudy); $("studyReset").onclick=function(){ $("studySearch").value=""; filterStudy();}; $("studyPrint").onclick=function(){window.print();}; buildStudy();

function lotfRender(filter){var wrap=$("lotfList");wrap.innerHTML="";LOTF_NOTES.filter(function(n){return !filter||filter==="All"||n.type===filter;}).forEach(function(n){var card=document.createElement("div");card.className="card";card.style.marginBottom="10px";card.innerHTML="<div class='pill' style='margin-bottom:6px'>"+n.type+"</div><div>"+n.text+"</div>";wrap.appendChild(card);});}
$("lotfAll").onclick=function(){lotfRender("All")}; $("lotfPlot").onclick=function(){lotfRender("Plot")}; $("lotfThemes").onclick=function(){lotfRender("Themes")}; $("lotfChars").onclick=function(){lotfRender("Characters")}; $("lotfSymbol").onclick=function(){lotfRender("Symbolism")}; $("lotfPrint").onclick=function(){window.print();}; lotfRender("All");

/* Shakespeare: Study Q&A + MCQ Practice + Short Answer */
var SHAKESPEARE_QA=[
 {section:"POETRY ‚Äî Sonnet 18",items:[
   {q:"What scene starts the poem?",a:"A summer‚Äôs day compared to the beloved."},
   {q:"Identify 'the eye of heaven'.",a:"Metaphor/personification for the sun."},
   {q:"Meaning of 'summer‚Äôs lease'?",a:"Summer is temporary; a fixed term that ends."},
   {q:"What happens at the volta (line 9)?",a:"Turns to the beloved‚Äôs 'eternal summer' preserved by verse."},
   {q:"Explain 'So long lives this‚Ä¶' in your own words.",a:"As long as the poem lasts, it keeps the beloved alive."}
 ]},
 {section:"DRAMA ‚Äî Romeo & Juliet (Balcony/Theme)",items:[
   {q:"Paraphrase 'Wherefore art thou Romeo?'",a:"Why must you be Romeo (a Montague) ‚Äî not 'Where are you?'."},
   {q:"What conflict drives the scene?",a:"Love versus family identity/feud."},
   {q:"'I‚Äôll be new baptised' shows what about Romeo?",a:"Impulsive, willing to change his name for love."},
   {q:"How does the scene push the plot?",a:"Their decision for secret love speeds the tragedy."}
 ]}
];
function buildShQA(){
  var wrap=$("shQA");wrap.innerHTML="";
  SHAKESPEARE_QA.forEach(function(sec){
    var h=document.createElement("h3");h.textContent=sec.section;wrap.appendChild(h);
    sec.items.forEach(function(it){
      var card=document.createElement("div");card.className="card";card.style.marginBottom="10px";
      card.innerHTML="<div><b>"+it.q+"</b></div><div class='qa' style='display:none;margin-top:6px'>"+it.a+"</div><div class='row' style='margin-top:8px'><button class='btn secondary btnShow'>Show Answer</button></div>";
      var btn=card.querySelector(".btnShow"), ans=card.querySelector(".qa");
      btn.addEventListener("click",function(){var vis=ans.style.display!=="none";ans.style.display=vis?"none":"block";btn.textContent=vis?"Show Answer":"Hide Answer";});
      wrap.appendChild(card);
    });
  });
}
function buildShMCQ(){
  var box=$("shMCQ");box.innerHTML="";
  MCQ.forEach(function(q,i){
    var card=document.createElement("div");card.className="card";card.style.marginBottom="10px";
    var opts=q.options.map(function(o,ix){return "<div>"+String.fromCharCode(65+ix)+") "+o+"</div>";}).join("");
    var tag="<div class='pill' style='display:inline-flex;gap:8px;align-items:center;margin-bottom:6px'><span style='width:10px;height:10px;border-radius:50%;background:"+ (CAT_COLORS[q.cat]||"#8a5cff")+"'></span>"+q.cat+"</div>";
    card.innerHTML= tag+"<div><b>Q"+(i+1)+". "+q.q+"</b></div><div style='margin-top:6px'>"+opts+"</div><div class='ans' style='display:none;margin-top:6px'><b>Answer:</b> "+q.correct+"</div><div class='row' style='margin-top:8px'><button class='btn secondary showAns'>Show Answer</button></div>";
    var btn=card.querySelector(".showAns"), ans=card.querySelector(".ans");
    btn.addEventListener("click",function(){var vis=ans.style.display!=="none";ans.style.display=vis?"none":"block";btn.textContent=vis?"Show Answer":"Hide Answer";});
    box.appendChild(card);
  });
}
function buildShSA(){
  var box=$("shSA"); box.innerHTML="";
  SHAKESPEARE_SA.forEach(function(sec){
    var tag=document.createElement("div"); tag.className="pill"; tag.style.margin="6px 0"; tag.textContent=sec.section; box.appendChild(tag);
    sec.items.forEach(function(it){
      var card=document.createElement("div"); card.className="card"; card.style.marginBottom="10px";
      card.innerHTML="<div><b>"+it.q+"</b></div><div class='qa' style='display:none;margin-top:6px'>"+it.a+"</div><div class='row' style='margin-top:8px'><button class='btn secondary btnShow'>Show Answer</button></div>";
      var btn=card.querySelector(".btnShow"), ans=card.querySelector(".qa");
      btn.addEventListener("click",function(){var vis=ans.style.display!=="none";ans.style.display=vis?"none":"block";btn.textContent=vis?"Show Answer":"Hide Answer";});
      box.appendChild(card);
    });
  });
}
$("shExpandAll").onclick=function(){[].slice.call(document.querySelectorAll("#shQA .qa, #shMCQ .ans, #shSA .qa")).forEach(function(a){a.style.display="block"});[].slice.call(document.querySelectorAll("#shQA .btnShow, #shMCQ .showAns, #shSA .btnShow")).forEach(function(b){b.textContent="Hide Answer"});};
$("shCollapseAll").onclick=function(){[].slice.call(document.querySelectorAll("#shQA .qa, #shMCQ .ans, #shSA .qa")).forEach(function(a){a.style.display="none"});[].slice.call(document.querySelectorAll("#shQA .btnShow, #shMCQ .showAns, #shSA .btnShow")).forEach(function(b){b.textContent="Show Answer"});};
$("shPrint").onclick=function(){window.print();};
buildShQA(); buildShMCQ(); buildShSA();

/* ===== ROAD RAGE (3 lanes, narrower road, lives & crashes) ===== */
var RoadRage=(function(){
  var cvs=$("drvCanvas"), ctx=cvs.getContext("2d"), DPR=1, W=360, H=540;
  var lanes=3, roadMargin=0.24, laneX=[], dashes=[], pxBase=220, pxPerSec=220;
  var running=false, last=0, meters=0, speed=50, nextCP=500, score=0;
  var pickup=null, obstacles=[], boosts=[];
  var lives=3, respawn=false, respawnTimer=null;
  var player={lane:1,y:0,color:"#00f5d4",visible:true};

  function dprScale(){
    var cssW=Math.min(520, Math.floor(window.innerWidth*0.94));
    var cssH=Math.floor(cssW*1.5);
    cvs.style.width=cssW+"px"; cvs.style.height=cssH+"px";
    DPR = window.devicePixelRatio || 1;
    W = cssW; H = cssH;
    cvs.width=Math.floor(cssW*DPR); cvs.height=Math.floor(cssH*DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);
    var left=W*roadMargin, right=W*(1-roadMargin), inner=right-left;
    laneX=[]; for(var i=0;i<lanes;i++){ laneX.push(left+inner*((i+0.5)/lanes)); }
    dashes=[]; for(var y=0;y<H;y+=60){dashes.push({y:y});}
    pxBase = H/2.6;
    player.y=Math.floor(H*0.86);
    draw();
  }

  function rr(x,y,w,h,r){if(r>w/2)r=w/2;if(r>h/2)r=h/2;ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.quadraticCurveTo(x+w,y,x+w,y+r);ctx.lineTo(x+w,y+h-r);ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);ctx.lineTo(x+r,y+h);ctx.quadraticCurveTo(x,y+h,x,y+h-r);ctx.lineTo(x,y+r);ctx.quadraticCurveTo(x,y,x+r,y);ctx.closePath();}
  function drawCar(cx,cy,color){var w=36,h=56,x=cx-w/2,y=cy-h/2;ctx.fillStyle=color;ctx.strokeStyle="#233";ctx.lineWidth=2;rr(x,y,w,h,8);ctx.fill();ctx.stroke();ctx.fillStyle="#071018";rr(x+6,y+6,w-12,14,4);ctx.fill();}
  function drawCone(cx,cy){ctx.fillStyle="#ffbd66";ctx.strokeStyle="#8a5b1f";ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(cx,cy-16);ctx.lineTo(cx-12,cy+16);ctx.lineTo(cx+12,cy+16);ctx.closePath();ctx.fill();ctx.stroke();}
  function drawBoost(cx,cy){ctx.fillStyle="#2ecc71";ctx.beginPath();ctx.arc(cx,cy,12,0,Math.PI*2);ctx.fill();ctx.fillStyle="#061314";ctx.font="bold 14px Arial";ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText("+",cx,cy+1);}

  function draw(){
    ctx.fillStyle="#0a0f21";ctx.fillRect(0,0,W,H);
    var left=W*roadMargin,right=W*(1-roadMargin);
    ctx.fillStyle="#0f1837";ctx.fillRect(left,0,right-left,H);
    ctx.strokeStyle="#cfe7ff";ctx.setLineDash([12,12]);ctx.lineWidth=2;ctx.beginPath();ctx.moveTo((left+right)/2,0);ctx.lineTo((left+right)/2,H);ctx.stroke();ctx.setLineDash([]);
    ctx.strokeStyle="#fca311";ctx.lineWidth=6;for(var i=0;i<dashes.length;i++){ctx.beginPath();ctx.moveTo(left+20,dashes[i].y);ctx.lineTo(right-20,dashes[i].y);ctx.stroke();}
    for(i=0;i<obstacles.length;i++){var ob=obstacles[i];if(ob.type==="cone")drawCone(laneX[ob.lane],ob.y);else drawCar(laneX[ob.lane],ob.y,"#ffffff");}
    for(i=0;i<boosts.length;i++){drawBoost(laneX[boosts[i].lane],boosts[i].y);}
    if(pickup){drawCar(laneX[pickup.lane], pickup.y, "#9ad0ff");}
    if(player.visible) drawCar(laneX[player.lane],player.y,player.color);
  }

  function reset(){
    meters=0;nextCP=500;score=0;pickup=null;obstacles=[];boosts=[];player.lane=1;speed=50;lives=3;player.visible=true;respawn=false;
    $("drvDist").textContent=0;$("drvScore").textContent=0;$("drvSpeed").textContent=speed;$("drvLives").textContent=lives;
    $("drvGameOver").style.display="none"; dprScale();draw();
  }

  function update(ts){
    if(!running){last=ts;return;}
    var dt=(ts-last)/1000; last=ts;

    pxPerSec = pxBase * (speed/50);
    for(var i=0;i<dashes.length;i++){dashes[i].y+=pxPerSec*dt; if(dashes[i].y>H)dashes[i].y-=H;}
    meters += speed*dt; $("drvDist").textContent=Math.floor(meters); $("drvSpeed").textContent=Math.floor(speed);

    if(!pickup && Math.random()<0.010){pickup={lane:Math.floor(Math.random()*lanes),y:-60};}
    if(Math.random()<0.018){obstacles.push({lane:Math.floor(Math.random()*lanes),y:-30,type:Math.random()<0.6?"cone":"car"});}
    if(Math.random()<0.012){boosts.push({lane:Math.floor(Math.random()*lanes),y:-40});}

    if(pickup){pickup.y+=pxPerSec*0.9*dt; if(pickup.y>H+60)pickup=null;}
    for(i=obstacles.length-1;i>=0;i--){obstacles[i].y+=pxPerSec*dt; if(obstacles[i].y>H+40)obstacles.splice(i,1);}
    for(i=boosts.length-1;i>=0;i--){boosts[i].y+=pxPerSec*dt; if(boosts[i].y>H+40)boosts.splice(i,1);}

    if(!respawn){
      if(pickup && pickup.lane===player.lane && Math.abs(pickup.y-player.y)<40){running=false; showQuestion(true); pickup=null;}
      for(i=obstacles.length-1;i>=0;i--){var ob2=obstacles[i]; if(ob2.lane===player.lane && Math.abs(ob2.y-player.y)<40){crash(); obstacles.splice(i,1); break;}}
      for(i=boosts.length-1;i>=0;i--){var b=boosts[i]; if(b.lane===player.lane && Math.abs(b.y-player.y)<40){boosts.splice(i,1); speed=Math.min(250, speed+50); $("drvSpeed").textContent=Math.floor(speed); toast("‚ö° Speed +50 ‚Üí "+Math.floor(speed)+" m/s"); beep("ok"); }}
    }

    if(meters>=nextCP){running=false;showQuestion(false);nextCP+=500;}
    draw(); requestAnimationFrame(update);
  }

  function crash(){
    lives--; $("drvLives").textContent=lives; thumbsDown("Crashed! ‚àí1 life");
    player.visible=false; respawn=true; speed=Math.max(50, speed-50);
    if(lives<=0){ gameOver(); return; }
    if(respawnTimer) clearTimeout(respawnTimer);
    respawnTimer=setTimeout(function(){ player.visible=true; respawn=false; }, 1000);
  }

  function gameOver(){
    running=false; player.visible=false; $("drvGameOver").style.display="flex";
    STATS.driver.bestMeters=Math.max(STATS.driver.bestMeters,Math.floor(meters)); saveStats(); refreshDash();
  }

  function showQuestion(bonus){
    var overlay=$("drvOverlay"); overlay.style.display="flex";
    var q=MCQ[Math.floor(Math.random()*MCQ.length)];
    document.documentElement.style.setProperty("--theme", CAT_COLORS[q.cat]||"#8a5cff");
    $("drvQ").innerHTML="<div class='pill' style='margin-bottom:6px;display:inline-flex;gap:8px;align-items:center'><span style='width:10px;height:10px;border-radius:50%;background:"+ (CAT_COLORS[q.cat]||"#8a5cff")+"'></span>"+q.cat+"</div>"+q.q;
    var box=$("drvOpts"); box.innerHTML="";
    q.options.slice().sort(function(){return Math.random()-0.5;}).forEach(function(opt){
      var btn=document.createElement("button"); btn.className="btn secondary"; btn.textContent=opt;
      btn.onclick=function(){
        if(opt===q.correct){ overlay.style.display="none"; score+=bonus?200:100; $("drvScore").textContent=score; confetti(bonus?"+Bonus!":"Correct!");
          STATS.driver.bestMeters=Math.max(STATS.driver.bestMeters,Math.floor(meters)); saveStats(); refreshDash(); run();
        }else{ thumbsDown("Incorrect ‚Äî try again"); }
      };
      box.appendChild(btn);
    });
  }

  function left(){player.lane=Math.max(0,player.lane-1);draw();beep("open");}
  function right(){player.lane=Math.min(2,player.lane+1);draw();beep("open");}
  $("drvLeft").addEventListener("touchstart",function(e){e.preventDefault();left();}); $("drvRight").addEventListener("touchstart",function(e){e.preventDefault();right();});
  $("drvLeft").addEventListener("click",left); $("drvRight").addEventListener("click",right);
  var sx=null; cvs.addEventListener("touchstart",function(e){sx=e.touches[0].clientX;});
  cvs.addEventListener("touchend",function(e){if(sx===null)return;var dx=e.changedTouches[0].clientX-sx;if(dx<-20)left();else if(dx>20)right();sx=null;});

  function run(){running=true;last=performance.now();requestAnimationFrame(update);}
  function pause(){running=false;}
  $("drvStart").onclick=function(){reset();run();}; $("drvPause").onclick=pause;
  window.addEventListener("resize",dprScale); dprScale(); reset();
  return {pause:pause};
})();
</script>
</body>
</html>
